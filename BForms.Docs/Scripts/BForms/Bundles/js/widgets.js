(function(a){if(typeof define==="function"&&define.amd){define("bforms-fileupload",["jquery","jquery-fileupload","jquery.fileupload-validate","jquery-iframe-transport","bforms-ajax"],a)}else{a(window.jQuery)}})(function(a){var b=function(){};b.prototype.options={loadingClass:"loading",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,imageUrlParam:"AvatarUrl",imageSelector:".bs-uploadImage",deleteImageSelector:".bs-deleteImage",hasInitialImage:false};b.prototype._init=function(){this.$element=this.element;this._prepareOptions();this._initSelectors();this._initUpload();this._delegateEvents();this._initElement()};b.prototype._delegateEvents=function(){this.$element.on("click",this.options.deleteImageSelector,a.proxy(this._onDeleteClick,this))};b.prototype._initSelectors=function(){this.$image=this.$element.find(this.options.imageSelector)};b.prototype._initElement=function(){if(this.options.hasInitialImage==true){this._toggleBlockDelete(false)}};b.prototype._prepareOptions=function(){if(typeof this.$element.data("hasinitialimage")!=="undefined"){this.options.hasInitialImage=this.$element.data("hasinitialimage")}};b.prototype._initUpload=function(){this.$element.fileupload(a.extend(true,{url:this.options.url,autoUpload:true,start:a.proxy(this._onStart,this),progress:a.proxy(this._onProgress,this),done:a.proxy(this._onDone,this),stop:a.proxy(this._onStop,this),maxFileSize:this.options.maxFileSize,acceptFileTypes:this.options.acceptFileTypes,dropZone:this.$element,formData:a.proxy(this._getFormData,this)},this.options.fileUpload))};b.prototype._onStart=function(){this._toggleLoading(true);this._trigger("start",0,arguments)};b.prototype._onProgress=function(){this._trigger("progress",0,arguments)};b.prototype._onDone=function(d,c){var g=c.result.Data;var f=g[this.options.imageUrlParam];this._updateImage(f);this._toggleBlockDelete(false);this._trigger("done",0,arguments)};b.prototype._onStop=function(){this._toggleLoading(false);this._trigger("stop",0,arguments)};b.prototype._onDeleteClick=function(d){d.preventDefault();d.stopPropagation();if(this.options.deleteUrl){var c=this._getExtraData();a.bforms.ajax({url:this.options.deleteUrl,data:c,success:this._onDeleteSuccess,error:this._onDeleteError,context:this})}else{if(typeof this.options.defaultImageUrl!=="undefined"){this._updateImage(this.options.defaultImageUrl)}}};b.prototype._onDeleteSuccess=function(c){if(typeof c[this.options.imageUrlParam]!=="undefined"){this._updateImage(c[this.options.imageUrlParam])}else{if(typeof this.options.defaultImageUrl!=="undefined"){this._updateImage(this.options.defaultImageUrl)}}this._toggleBlockDelete(true)};b.prototype._onDeleteError=function(){};b.prototype._toggleLoading=function(c){if(this.options.loadingClass){if(c){this.$element.addClass(this.options.loadingClass)}else{this.$element.removeClass(this.options.loadingClass)}}};b.prototype._toggleBlockDelete=function(c){if(c){this.$element.find(this.options.deleteImageSelector).addClass("disabled")}else{this.$element.find(this.options.deleteImageSelector).removeClass("disabled")}};b.prototype._updateImage=function(c){if(this.$image.length){if(c.indexOf("?")===-1){c+="?"+new Date()}else{c+="&"+new Date()}this.$image.attr("src",c)}};b.prototype._getExtraData=function(c){if(typeof c!=="object"||c===null){c={}}a.extend(true,c,this.options.extraData);this._trigger("getExtraData",0,c);return c};b.prototype._getFormData=function(){var c=[];if(typeof this.options.getFormData==="function"){c=this.options.getFormData()}return c};a.widget("bforms.bsFileUpload",b.prototype)});(function(a){if(typeof define==="function"&&define.amd){define("bforms-inlineQuestion",["jquery","bootstrap","jquery-ui-core","icanhaz"],a)}else{a(window.jQuery)}})(function(a){var b=function(c){this.options=a.extend(true,{},this.options,c)};b.prototype.options={template:'<p>{{question}}</p><hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button> {{/buttons}}',contentTemplate:'{{{content}}}<hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button> {{/buttons}}',placement:"left",placementArray:"left,right,bottom,top",content:undefined,stretch:false,closeOnOuterClick:true};b.prototype._init=function(){this.$element=this.element;if(this.options.placement==="auto"){this._placementArray=this.options.placementArray.split(",");this.options.placement=a.proxy(this._placementMethod,this)}if(typeof ich.renderPopoverQuestion!=="function"){ich.addTemplate("renderPopoverQuestion",this.options.template)}if(typeof ich.renderPopoverContent!=="function"){ich.addTemplate("renderPopoverContent",this.options.contentTemplate)}this._addPopover();if(this.options.stretch==true){this.$tip.css("max-width","none")}};b.prototype._delegateEvents=function(){this.$tip.on("click",".bs-popoverBtn",a.proxy(function(d){var f=this.$tip.find(".bs-popoverBtn").index(d.currentTarget),c=this.options.buttons[f];if(c!=null&&typeof c.callback==="function"){d.preventDefault();d.stopPropagation();c.callback.apply(this,arguments)}},this));if(this.options.closeOnOuterClick&&a(document).data("bsPopoverClickHandler")!==true){a(document).on("click",function(f){var d=a(f.target);var c=a(".bs-hasInlineQuestion").filter(function(i,h){var e=a(h),j=e.data("bs.popover");if(typeof j!=="undefined"&&j!=null){var g=j.$tip;return g.is(":visible")&&e[0]!=d[0]&&e.find(d).length==0&&d[0]!=g[0]&&g.find(d).length==0}return false});c.bsInlineQuestion("toggle")}).data("bsPopoverClickHandler",true)}};b.prototype._addPopover=function(){this.$element.popover(a.extend(true,{html:true,placement:this.options.placement,content:this._renderPopover()},this.options.popoverOptions)).addClass("bs-hasInlineQuestion");this.$element.on("show.bs.popover",a.proxy(function(){this._trigger("show",0,arguments)},this));this.$element.on("shown.bs.popover",a.proxy(function(){this._trigger("shown",0,arguments)},this));this.$element.on("hide.bs.popover",a.proxy(function(){this._trigger("hide",0,arguments)},this));this.$element.on("hidden.bs.popover",a.proxy(function(){this._trigger("hidden",0,arguments)},this));this.$tip=this.$element.data("bs.popover").tip();this._delegateEvents()};b.prototype._renderPopover=function(){return typeof this.options.content==="undefined"?ich.renderPopoverQuestion(this.options,true):ich.renderPopoverContent(this.options,true)};b.prototype.hide=function(){this.$element.popover("hide");return this};b.prototype.show=function(){this.$element.popover("show");return this};b.prototype.toggle=function(){this.$element.popover("toggle");return this};b.prototype.content=function(c){this.options.content=c.content;this.options.question=c.question;this.options.buttons=c.buttons;var d=this._renderPopover();this.$tip.find(".popover-content").html(d);return this};b.prototype.destroy=function(){this.hide();this.$element.popover("destroy");this.$element.removeData("bformsBsInlineQuestion");this.$element.removeClass("bs-hasInlineQuestion");this.$tip.remove()};b.prototype._placementMethod=function(l,f){var d=a(l),c=a(f),h=c.offset(),o=h.top,g=h.left,p=a(window).outerHeight(),q=a(window).outerWidth();var e=d.clone().appendTo(a("body")),n=e.outerWidth(),m=e.outerHeight();e.remove();var k={left:g,right:q-c.outerWidth()-g,top:o-a(window).scrollTop(),bottom:p-c.outerHeight()-(o-a(window).scrollTop())};for(var j in this._placementArray){var i=this._placementArray[j];if(i=="right"||i=="left"){if(k[i]>n){return i}}if(i=="top"||i=="bottom"){if(k[i]>m){return i}}}return this._placementArray[0]||"left"};a.widget("bforms.bsInlineQuestion",b.prototype)});define("bforms-sortable",["jquery","jquery-ui-core"],function(){var a=function(b){this.options={};$.extend(true,this.options,this._defaultOptions,b);this.init();this.$targetStack=[]};a.prototype._defaultOptions={selectors:{list:".bs-sortable",item:".bs-sortable-item",container:".sortable-container",placeholder:".placeholder",helper:".helper",trigger:".sortable-trigger"},classes:{helper:"helper",activePlaceholder:"placeholder-active",placeholder:"placeholder",trigger:"sortable-trigger",displacedLeft:"displaced-left",displacedRight:"displaced-right",noRightDisplacement:"no-right-displacement",noLeftDisplacement:"no-left-displacement"},display:{activePlaceholderHeight:30,inactivePlaceholderHeight:4,placeholderWidth:200,triggerWidth:200},draggable:{minimumDisplacementDistance:20,levelOffset:40,options:{}},droppable:{initialTolerance:"touch",activeTolerance:"touch",options:{}},snapEnabled:false,accept:function(b,c){var d=b.data("appends-to");if(d==null||!/\S/.test(d)){return false}var e=c.data("id");return d.indexOf(e)!==-1},serializationMode:"object",validateInDepth:true};a.prototype.serializationModes={object:"object",array:"array"};a.prototype.directions={left:-1,right:1};a.prototype.init=function(){$(this.options.selectors.item).each(function(f,d){$(d).data("_uid",f);$(d).attr("data-_uid",f)});this._createPlaceholders();var c={accept:this.options.selectors.item,tolerance:this.options.droppable.initialTolerance,over:$.proxy(this._evOnOverlap,this),out:$.proxy(this._evOnExit,this),greedy:true};$(this.options.selectors.placeholder).droppable(c);var b={drag:$.proxy(this._evOnDrag,this),start:$.proxy(this._evOnStart,this),stop:$.proxy(this._evOnStop,this),cursor:"move",helper:$.proxy(function(f){var g=$(f.currentTarget)[0].outerHTML;$(f.currentTarget).find(this.options.selectors.placeholder).droppable("option","accept",null);var d=$(g).data("_uid",$(f.currentTarget).data("_uid")).addClass("helper").css({height:"15px"});if(d.find(this.options.selectors.item).length!=0){d.find(this.options.selectors.list).remove()}return d},this)};if(this.options.snapEnabled){$.extend(true,b,{snap:this.options.selectors.item,snapTolerance:10,snapMode:"outer"})}$(this.options.selectors.item).draggable(b);this.options.draggable.options=b;this.options.droppable.options=c};a.prototype._createPlaceholders=function(){$(this.options.selectors.item).each($.proxy(function(c,b){$(b).after(this._placeholderHtmlFor($(b).data("_uid")))},this));$(this.options.selectors.list).each($.proxy(function(d,c){var b=$(c).children(this.options.selectors.item).first();b.before(this._placeholderHtmlFor($(c).data("_uid"),this.options.classes.noRightDisplacement))},this));$(this.options.selectors.list+":first").children(this.options.selectors.placeholder).addClass(this.options.classes.noLeftDisplacement);$(this.options.selectors.placeholder).each($.proxy(function(c,b){var d=this._getLevelFor($(b));$(b).data("data-_uid",$(b).attr("data-_uid"));$(b).data("offset",d);$(b).attr("data-offset",d)},this))};a.prototype._evOnDrag=function(b,c){};a.prototype._evOnStart=function(c,d){d.helper.addClass(this.options.classes.helper);var b=$(this.options.selectors.item+'[data-_uid="'+d.helper.data("_uid")+'"]:first');b.css("opacity",0.5);$(this.options.selectors.placeholder).css({height:"5px"});this.currentSource={ui:d,parent:$(c.target).parents(this.options.selectors.list+":first")};$(this.options.selectors.container).trigger({type:"drag-start",item:b})};a.prototype._evOnStop=function(c,d){d.helper.removeClass(this.options.classes.helper);this.$dropTarget=this.$targetStack.length!=0?this.$targetStack[0]:null;var f=false;if(this.$dropTarget!=null&&this._isValidMove(c,d)){this._dropDraggedElement(c,d);this.$targetStack=[];f=true}else{this._resetDraggedElement(c,d);this.$targetStack.splice(this.$targetStack.length-1,1)}var b=$(this.options.selectors.item+'[data-_uid="'+d.helper.data("_uid")+'"]');b.find(this.options.selectors.placeholder).droppable("option","accept",this.options.selectors.item);b.css("opacity",1);$(this.options.selectors.placeholder).animate({height:this.options.display.inactivePlaceholderHeight,"border-width":"0px"},{duration:100,complete:$.proxy(function(){if(f){$(this.options.selectors.container).trigger({type:"update",updatedList:this._serialize(this.options.serializationMode)});f=false}},this)})};a.prototype._evOnOverlap=function(c,d){this.$targetStack.push($(c.target));var b=this._getItem(d.helper.data("_uid"));var f=parseInt(b.find("span:first").css("width").replace("px",""))+parseInt(b.find("span:last").css("width").replace("px",""));$(c.target).css({height:this.options.display.activePlaceholderHeight,width:f,"background-color":"inherit","border-style":"dotted","border-color":"black","border-width":"1px"});this.helperInitialLeft=d.offset.left;this._toggleHorizontalChangeListening($(c.target),d.draggable,true);$(this.options.selectors.container).trigger({type:"over",item:b,placeholder:$(c.target)})};a.prototype._toggleHorizontalChangeListening=function(c,b,d){d=typeof d=="undefined"?true:d;if(d){b.on("drag",$.proxy(function(f,g){this._checkDepthChange(f,g)},this))}else{b.unbind("drag")}};a.prototype._evOnExit=function(b,c){this.$targetStack.splice(this.$targetStack.length-1,1);$(b.target).animate({height:this.options.display.inactivePlaceholderHeight,"border-width":"0px"},100);this._resetPlaceholderDisplacements();this._toggleHorizontalChangeListening($(b.target),c.draggable,false)};a.prototype._checkDepthChange=function(f,g){var d=Math.abs(g.offset.left-this.helperInitialLeft);var b=this.options.draggable.minimumDisplacementDistance;var c=g.offset.left-this.helperInitialLeft<=0?this.directions.left:this.directions.right;if(d>=b&&this.$targetStack.length!=0){this._changeDepth(f,g,c)}};a.prototype._changeDepth=function(g,l,d){var b=this.$targetStack[0];var i=parseInt(b.css("margin-left").replace("px",""));var c=this._getLevelFor(b);var j=this.options.draggable.levelOffset;if((-1)*c*this.options.draggable.levelOffset>i+d*j||i+d*j>this.options.draggable.levelOffset){this.helperInitialLeft=l.offset.left;return}if(typeof b!="undefined"&&b!=null){var h=(b.hasClass(this.options.classes.noLeftDisplacement)&&d==this.directions.left)||(b.hasClass(this.options.classes.noRightDisplacement)&&d==this.directions.right);if(h){this.helperInitialLeft=l.offset.left;return}b.css("margin-left",i+d*j+"px");var f=d==this.directions.left?this.options.classes.displacedLeft:this.options.classes.displacedRight;if(!b.hasClass(f)){b.addClass(f)}var k=parseInt(b.data("offset"));b.data("offset",k+d)}this.helperInitialLeft=l.offset.left};a.prototype._isValidMove=function(g,i){var b=i.helper;var f=this.$dropTarget;if(this.options.accept==null||typeof this.options.accept!="function"){return true}var c=f.data("_uid")!==b.data("_uid")?this._getItem(f.data("_uid")):f.siblings(this.options.selectors.item+":first");if(f.data("_uid")=="undefined"){c=f.parents(this.options.selectors.item+":first")}var h=this._elementsOnSameLevel(b,c,f);var j=this.options.accept(b,c);if(this.options.validateInDepth){var d=f.parents(this.options.selectors.item);var k=true;d.each($.proxy(function(l,e){if(!this.options.accept(b,$(e))){k=false}},this));if(!k){return false}}return h||j};a.prototype._resetDraggedElement=function(b,c){c.helper.css({top:0,left:0})};a.prototype._elementsOnSameLevel=function(b,e,d){if(d.hasClass(this.options.classes.displacedLeft)||d.hasClass(this.options.classes.displacedRight)){return false}var c=b.parents(this.options.selectors.list+":first");var f=e.parents(this.options.selectors.list+":first");return c.data("_uid")==f.data("_uid")};a.prototype._getLevelFor=function(b){return b.parents(this.options.selectors.item).length};a.prototype._countLevels=function(c){c=c||$(this.options.selectors.list+":first");var d=0;var b=c.children(this.options.selectors.item);if(b.length==0){return 0}b.each($.proxy(function(g,f){d=Math.max(d,this._countLevels($(f).children(this.options.selectors.list+":first")))},this));return d+1};a.prototype._dropDraggedElement=function(i,l){var h=this.$dropTarget;var b=$(this.options.selectors.item+'[data-_uid="'+l.helper.data("_uid")+'"]:first');var g=$(this.options.selectors.placeholder+'[data-_uid="'+b.data("_uid")+'"]');if(!h.hasClass(this.options.classes.displacedLeft)&&!h.hasClass(this.options.classes.displacedRight)){h.after(b)}else{var j=this._getLevelFor(h);if(h.hasClass(this.options.classes.displacedLeft)){var k=parseInt(h.data("offset"));var d=h.parents(this.options.selectors.item);var c=d[j-k-1];$(c).after(b)}else{var f=h.data("_uid")!==b.data("_uid")?this._getItem(h.data("_uid")):h.siblings(this.options.selectors.item+":first");f.children(this.options.selectors.list+":first").append(b)}this.depthChangeInProgress=false}this.depthChangeInProgress=false;this.helperInitialLeft=0;this._resetPlaceholderDisplacements();g.remove();this._insertPlaceholderAfter(b)};a.prototype._hideAllPlaceholders=function(b){$(this.options.selectors.placeholder).each(function(d,c){if(typeof b!=="undefined"&&b!=null&&$(c).data("_uid")===b){return}$(c).animate({height:"0","border-width":"0px"},100)})};a.prototype._resetPlaceholderDisplacements=function(){var b=$(this.options.selectors.placeholder);b.each($.proxy(function(f,d){var c=$(d);var g=this._getLevelFor(c);c.removeClass(this.options.classes.displacedLeft);c.removeClass(this.options.classes.displacedRight);c.data("offset",g);c.attr("data-offset",g);c.css("margin-left","0px")},this))};a.prototype._getActivePlaceholders=function(){var b=[];$(this.options.selectors.placeholder).each($.proxy(function(d,c){if($(c).css("height")==this.options.display.activePlaceholderHeight+"px"){b.push($(c))}},this));return b};a.prototype._togglePlaceholder=function(g,f){var c=this._getPlaceholder(g);var b=this._getItem(g);var e=f?this.options.display.activePlaceholderHeight:this.options.display.inactivePlaceholderHeight;var d=f?"2px":"0px";c.animate({height:e,width:b.css("width"),"background-color":"inherit","border-style":"dotted","border-color":"black","border-width":d},100);c.droppable({olerance:"pointer",over:$.proxy(this._evOnOverlap,this),out:$.proxy(this._evOnExit,this),accept:this.options.selectors.item})};a.prototype._getById=function(b,c){return $(b+'[data-_uid="'+c+'"]')};a.prototype._getPlaceholder=function(b){return this._getById(this.options.selectors.placeholder,b)};a.prototype._getTrigger=function(b){return this._getById(this.options.selectors.trigger,b)};a.prototype._getItem=function(b){return this._getById(this.options.selectors.item,b)};a.prototype._insertPlaceholderAfter=function(b){b.after('<div class="placeholder placeholder-active" data-_uid="'+b.data("_uid")+'"></div>');var c=$(this.options.selectors.placeholder+'[data-_uid="'+b.data("_uid")+'"]');c.data("_uid",b.data("_uid"));c.droppable(this.options.droppable.options)};a.prototype._placeholderHtmlFor=function(c,b){b=b||"";return'<div style="height: 4px;" class="placeholder '+b+'" data-_uid="'+c+'"></div>'};a.prototype._serialize=function(b){b=b||this.serializationModes.object;if(b===this.serializationModes.object){return this._serializeList($(this.options.selectors.container+" > "+this.options.selectors.list))}if(b===this.serializationModes.array){return this._serializeAsArray()}return this._serializeList($(this.options.selectors.container+" > "+this.options.selectors.list))};a.prototype._serializeList=function(c){var d=[];var b=c.children(this.options.selectors.item);b.each($.proxy(function(g,f){d.push({Id:$(f).data("id"),Name:$(f).children("span:last").text(),Order:this._getOrderFor($(f)),Children:this._serializeList($(f).children(this.options.selectors.list))})},this));return d.length!=0?d:null};a.prototype._serializeAsArray=function(){var b=$(this.options.selectors.container).find(this.options.selectors.item);var c=[];var d=$(this.options.selectors.container).data("parent-property");b.each($.proxy(function(g,f){var l=$(f).parents(this.options.selectors.item+":first").data("id");var k=this._getOrderFor($(f));var h=$(f).data("id");var j={Id:h,Order:k,Name:$(f).children("span:last").text()};j[d]=l;c.push(j)},this));return c};a.prototype._getOrderFor=function(b){var d=0;var c=b.parents(this.options.selectors.list+":first");c.children(this.options.selectors.item).each(function(g,f){if($(f).data("_uid")===b.data("_uid")){d=g;return}});return d};$.fn.extend({bsSortable:function(c){var d={selectors:{}};if(typeof c!=="undefined"&&c!=null){d.selectors.item=c.itemSelector;d.selectors.list=c.listSelector;d.selectors.container=c.containerSelector;d.accept=c.accept;d.snapEnabled=c.snapEnabled;d.serializationMode=c.serialize;d.validateInDepth=c.validateInDepth}var b=new a(d);this.data("bsSortable",b)}});return a});var factory=function(a,b,d){var c=function(e){this.options=a.extend(true,this.options,e)};c.prototype.options={alternate:true,sortable:false,allowDuplicates:true};c.prototype._init=function(){this.$element=this.element;this.$select=this.$element.parents(".input-group").find("select");this.select2Options=this.$element.data("select2").opts;this.currentTagsIndex=""+0;this._select2PopulateResults=a.proxy(this.select2Options.populateResults,this.$element.data("select2"));this.initialTags=a.extend(true,this.options.tags);this.options.tags=this._evaluateInitialTags(this.options.tags);this.values=[];this._setTags(this.options.tags[0]);this.stateBeforeRemoval=[];this.currentTags=this.options.tags[0];this._uid=0;if(this.options.selectedValues){this._testSelectedValues(this.options.selectedValues);this._initInitialValues(this.options.selectedValues)}if(this.options.initialTags){this._setInitialTags(this.options.initialTags)}if(this.options.sortable){this._initSortable()}this._addDelegates()};c.prototype._addDelegates=function(){this.$element.on("change",a.proxy(this._evSelect2Change,this))};c.prototype._initSortable=function(f){var e=this.$element.parents(".input-group").find(".select2-choices");if(f&&e.data("ui-sortable")){e.sortable("destroy")}e.find(".select2-search-choice").css("cursor","pointer");e.css("overflow","auto");e.sortable({containment:"parent",start:a.proxy(this._evSelect2SortStart,this),update:a.proxy(this._evSelect2SortEnd,this)})};c.prototype._setInitialTags=function(j){var k=[];var g=j.map(function(i){return i.id||null});var n=j.map(function(i){return i.text||i});for(var h in j){var f=g[h],m=n[h],l=this.options.tags[this._getIndexFromTags([{id:f,text:m}])];if(f==null){for(var e in l){if(l[e].text===m){f=l[e].id;break}}}k.push({id:f,text:m,tags:l,_uid:++this._uid})}this.currentTagsIndex=this._getIndexFromTags(k);this._setTags(k);this._fixSelect2Choices()};c.prototype._initInitialValues=function(f){this._setSelectedValues(this.options.selectedValues);var e=typeof this.options.getNextTags=="function"?this.options.getNextTags(this.val(),0,this.options.tags[0],this.options.tags):this.options.tags[this.currentTagsIndex];this.currentTagsIndex=this._getIndexFromTags(e);this.currentTags=this.options.tags[this.currentTagsIndex]};c.prototype._evSelect2Change=function(j){if(typeof j.added=="undefined"&&typeof j.removed=="undefined"){return}var h=this.options.tags[this.currentTagsIndex],n=this.currentTagsIndex,m=[];if(j.added){var g=j.added;this.added={id:g.id||g,text:g.text||g,tags:h,_uid:this._uid}}if(j.removed){var p=j.removed;this.removed={id:p.id||p,text:p.text||text,tags:h,_uid:this._uid}}if(this.options.alternate){var q=this._getNextTags();q=this._alterTags(q);this._setTags(q);m=q}if(j.added){var g=j.added;this.values.push({id:g.id||g,text:g.text||g,tags:h,_uid:this._uid});if(this._isNewTag(j.added,h)){this.options.tags[this.currentTagsIndex].push(j.added)}var f=this.$element.parents(".input-group").find(".select2-choices > .select2-search-choice:last");f.data("_uid",this._uid)}if(j.removed){j.preventDefault();var p=a.extend(true,{},j.removed);var o=this.$element.select2("val").map(a.proxy(function(e){return this._fixId(e.id||e)},this)),l=this.values.map(function(e){return e.id||e});for(var k in l){if(o[k]!==""+l[k]){this.values.splice(k,1);break}}this.removed=j.removed}this._uid=this._uid+1;this._fixSelect2Choices();if(this.options.sortable&&(j.added||j.removed)){this._initSortable()}};c.prototype._evSelect2SortStart=function(f){this.$element.select2("onSortStart")};c.prototype._evSelect2SortEnd=function(f){this.$element.select2("onSortEnd");var h=this._setValuesFromSelect2(this.$element.select2("val"));if(this.options.alternate&&typeof this.options.getNextTags=="function"){var g=this.options.getNextTags(h,parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags);this.currentTagsIndex=this._getIndexFromTags(g);g=this._alterTags(g);this.currentTags=g;this._setTags(g);this._initSortable(true);this._fixSelect2Choices()}};c.prototype._getNextTags=function(h){var f=h||(this.currentTagsIndex+1)%this.options.tags.length,j=[];if(typeof this.options.getNextTags=="function"){var k=this.val();if(this.added){k.push({id:this.added.id||this.added,text:this.added.text||this.added});this.added=undefined}if(this.removed){var g;for(var e in k){if(k[e].id==this.removed.id){g=e;break}}if(g){k.splice(g,1)}this.removed=undefined}j=this.options.getNextTags(k,parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags);f=this._getIndexFromTags(j);this.currentTagsIndex=f;this.currentTags=j.slice();return j}this.currentTagsIndex=f;j=this.options.tags[this.currentTagsIndex];this.currentTags=j.slice();return j};c.prototype._getIndexFromTags=function(k){var e=this.options.tags;for(var h in e){var f=e[h].map(function(i){return i.text||i});var l=k.map(function(i){return i.text||i});var j=true;for(var g in l){if(f.indexOf(l[g])==-1){j=false;break}}if(j){return h}}return null};c.prototype._setTags=function(h){h=a.isArray(h)?h:[];var f={tags:h,populateResults:a.proxy(this._populateResults,this),matcher:function(m,i,l){return i.toUpperCase().indexOf(m.toUpperCase())!=-1}};this.$select.empty();for(var e in h){var g=h[e],j=g.text||g,k=g.id||g;this.$select.append('<option value="'+k+'">'+j+"</option>")}this.select2Options.tags=[];this.$element.select2("destroy");this.$element.select2(a.extend(true,this.select2Options,f))};c.prototype._mergeTags=function(g){var e=this.$element.data("select2").opts.tags;for(var f in g){e.push(g[f])}this._setTags(e)};c.prototype._populateResults=function(e,l,k){var m=this._alterTags(this.currentTags),h=[];var f=typeof this.options.finalize=="function"?this.options.finalize(this.val(),this.currentTagsIndex,this.options.tags[this.currentTagsIndex],this.options.tags):false;if(f){this._select2PopulateResults(e,[],k);return}for(var g in m){var n=m[g].text||m[g];if(k.term==null||k.term===""||n.indexOf(k.term)!=-1){h.push(m[g])}}if(k.term!=null&&k.term!=""){var j=this._createSearchChoice(k.term);if(j){h.push(j)}}if(!this._duplicatesAllowed()){h=this._removeDuplicates(h)}this._select2PopulateResults(e,h,k)};c.prototype._alterIds=function(g){var f=this.$element.select2("val");for(var e in g){if(f.indexOf(""+g[e].id)!=-1){g[e].id="_"+g[e].id}}return g};c.prototype._fixSelect2Choices=function(){var e=this.$element.parents(".input-group").find(".select2-choices > .select2-search-choice");e.each(a.proxy(function(k,h){var f=a(h),g=f.find("div:first");for(var j in this.values){if(j===""+k){g.text(this.values[j].text);break}}},this))};c.prototype._isId=function(h){var e=this.options.tags[this.currentTagsIndex];for(var f in e){var g=e[f].id||e[f];if(""+g===h){return true}}return false};c.prototype._getTagById=function(f){var g=this.options.tags[this.currentTagsIndex];for(var e in g){if(g[e].id===""+f){return g[e]}}return undefined};c.prototype._getTagByIdFromAllTags=function(g){var e=this.options.tags;for(var h in e){var j=e[h];for(var f in j){if(""+j[f].id===""+g){return j[f]}}}return undefined};c.prototype._getTagByText=function(g){var f=this.options.tags[this.currentTagsIndex];for(var e in f){if(f[e].text===g){return f[e]}}return undefined};c.prototype._alterTags=function(g,h){var n="",o=h||this.$element.select2("val"),p=[],e=this._duplicatesAllowed();for(var k in g){var l=g[k].id||g[k],q=g[k].text||g[k];if(typeof g[k].id!="undefined"&&e){var f=0;for(var m in o){var r=o[m].replace(/_+/g,"");if(r===l){f++}}for(var m=0;m<f;m++){n+="_"}}p.push({id:n+l,text:q})}return p};c.prototype._fixId=function(e){var f=e.match(/_+/g);if(f){e=e.slice(e.indexOf(f[0])+f[0].length)}return e};c.prototype._createSearchChoice=function(e){if(typeof this.options.createSearchChoice!="undefined"){if(typeof this.options.createSearchChoice=="boolean"){return this.options.createSearchChoice?{id:e,text:e}:null}if(typeof this.options.createSearchChoice=="function"){return this.options.createSearchChoice(e)}}return true};c.prototype._duplicatesAllowed=function(){var e=false;if(typeof this.options.allowDuplicates!="undefined"){if(typeof this.options.allowDuplicates=="boolean"){e=this.options.allowDuplicates}if(typeof this.options.allowDuplicates=="function"){e=this.options.allowDuplicates(this.val(),parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags)}}return e};c.prototype._removeDuplicates=function(g){var j=this.values.map(function(i){return i.text||i});var h=g.map(function(i){return i.text||i});var f=[];for(var e in h){if(j.indexOf(h[e])==-1){f.push(g[e])}}return f};c.prototype._isNewTag=function(f,e){var h=f.text||f,g=e.map(function(i){return i.text||i});return g.indexOf(h)==-1};c.prototype._evaluateInitialTags=function(m){var f=[];for(var k in m){var g=m[k],e=[];for(var h in g){var j=g[h].id||g[h],n=g[h].text||g[h];var l={id:j,text:n};e.push(l)}f.push(e)}return f};c.prototype._setSelectedValues=function(k){this.values=[];var h=k.map(function(i){return i.id||null});var n=k.map(function(i){return i.text||i});for(var j in k){var g=h[j],m=n[j],l=this.options.tags[this._getIndexFromTags([{id:g,text:m}])];if(g==null){for(var f in l){if(l[f].text===m){g=l[f].id;break}}}this.values.push({id:g,text:m,tags:l,_uid:++this._uid})}h=this.values.map(function(i){return i.id});var e=this._alterIds(h);this.$element.select2("val",e);this._fixSelect2Choices();return this.values};c.prototype._alterIds=function(j){var e=[],f={};for(var k in j){if(typeof f[""+j[k]]!="undefined"){f[""+j[k]]++}else{f[""+j[k]]=1}var h=j[k];if(f[""+j[k]]!=1){for(var g=1;g<f[""+j[k]];g++){h="_"+h}}e.push(h)}return e};c.prototype._setSelect2Choices=function(j){var h=j.map(function(i){return{id:i.id||i,text:i.text||i}});var e=this.$element.parents(".input-group").find(".select2-choices");e.empty();for(var g in h){var f='<li class="select2-search-choice"><div>'+h[g].text+'</div><a href="#" onclick="return false;" class="select2-search-choice-close" tabindex="-1"></a></li>';e.append(f)}e.parents(".select2-container").removeClass("select2-active")};c.prototype._setValuesFromSelect2=function(l){var g=l.map(a.proxy(this._fixId,this));this.values=[];for(var e in g){var f=g[e],h=this._getTagByIdFromAllTags(f),k=h.text||h,j=this.options.tags[this._getIndexFromTags([{id:f,text:k}])];this.values.push({id:f,text:k,tags:j})}return this.values};c.prototype._testSelectedValues=function(f){for(var e in f){if(!this._testSelectedValue(f[e])){throw {message:'No element with text "'+(f[e].text||f[e])+'" was found in tags'}}}return true};c.prototype._testSelectedValue=function(k){var e=this.options.tags,j=k.text||k;for(var g in e){var h=e[g];for(var f in h){if(""+h[f].text===""+j){return true}}}return false};c.prototype._normalizeTags=function(f){var e=f.map(function(g){return{id:g.id||g,text:g.text||g}});return e};c.prototype.val=function(e){if(e){this._setSelectedValues(e)}return this.values.map(a.proxy(function(f){return{id:typeof f.id!="undefined"?this._fixId(f.id):f,text:f.text||f}},this))};c.prototype.valid=function(){if(typeof this.options.validate=="function"){return this.options.validate(this.val())}if(typeof this.options.validate=="string"){var e=this.values.reduce(function(f,g){return(f.text||f)+(g.text||g)});return new RegExp(this.options.validate,"g").test(e)}if(typeof this.options.validate=="object"&&this.options.validate instanceof RegExp){var e=this.values.reduce(function(f,g){return(f.text||f)+(g.text||g)});return this.options.validate.test(e)}return true};c.prototype.preview=function(){var e=this.val();if(typeof this.options.preview=="function"){return this.options.preview(e)}return e.reduce(function(f,g){return(f.text||f)+", "+(g.text||g)})};c.prototype.valuesText=function(e){e=e||this.values;return e.map(function(f){return f.text||f})};c.prototype.tags=function(f,e){if(f&&f instanceof Array){this.options.tags=f.slice();this.currentTagsIndex="0";if(e){this.currentTags=this._getNextTags()}else{this.currentTags=this.options.tags[this.currentTagsIndex]}this.$element.select2({tags:this.currentTags});this.val([]);if(this.options.sortable){this._initSortable(true)}}return this.options.tags};a.widget("bforms.bsTaglist",c.prototype);return c};if(typeof window.define=="function"&&define.amd){define("bforms-taglist",["jquery","select2","jquery-ui-core"],factory)}else{factory(window.jquery)};define("bforms-grid",["jquery","jquery-ui-core","bforms-pager","bforms-editable","bforms-panel","bforms-ajax","bforms-namespace","bforms-inlineQuestion"],function(){var a=function(b){this.options=$.extend(true,{},this.options,b);this._init()};a.prototype.options={$toolbar:$([]),gridItem:".bs-item",gridItemDetails:".bs-details",gridDetailsContainer:".bs-rowDetails",hasOrder:true,orderContainerSelector:".title",orderElemSelector:".bs-orderColumn",multipleOrder:false,defaultPage:1,currentPage:1,goTopElement:null,uniqueName:null,gridRowsHeaderSelector:".bs-header",gridContainerSelector:".grid_rows",gridCountContainerSelector:"h2 > .badge",gridHeaderSelector:"h2",filterSelector:".bs-filter",resetGridSelector:".bs-resetGrid",addSelector:".bs-triggerAdd",expandToggleSelector:".bs-toggleExpand",inlineActionClass:"bs-inline_action",bulkContainerSelector:".bs-selectorsContainer",rowsContainerSelector:".grid_rows_wrapper",rowSelector:".grid_row",rowHeaderSelector:"header",rowDetailsSelector:".grid_row_details",rowActionsContainerSelector:".bs-row_controls",rowDetailsSuccessHandler:null,rowActions:[],updateRowUrl:null,hasRowCheck:true,rowCheckSelector:'.bs-row_check:not([disabled="disabled"])',headerCheckSelector:".check_all > input",groupActionsSelector:".bs-group_actions",pager:null,pagerUrl:null,onRefresh:null,pagerSelector:".bs-pager",pagerGoTopTitle:"Go top",pagerDataPageContainer:"page",detailsSelector:".bs-expand",detailsUrl:null,multipleDetails:true,removeDetailsOnCollapse:false,validationSummaryContainer:".bs-validation_summary",validationRowActionsContainer:".bs-validation_row_action",errorRowContainer:".bs-validation_row",errorCloseSelector:".bs-form-error .close",noResultsRowSelector:".bs-noResultsRow",sortable:true,rowClickExpandable:true,defaultFilterButtons:[{btnSelector:".js-all",filter:function(b){return true},},{btnSelector:".js-none",filter:function(b){return false},}]};a.prototype._refreshModel={OrderableColumns:[],Search:{},Page:1,PageSize:5,quickSearch:""};a.prototype._initialModel={PageSize:5};a.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"grid needs a unique name or the element on which it is aplied has to have an id attr"}this._initDefaultOptions();this._initSelectors();if(this.options.selectorsContainerTitle){this.$selectorsContainer.attr("title",this.options.selectorsContainerTitle)}this.options.hasRowCheck=this.$actionsContainer.length>0;this.hasDetails=this.options.detailsSelector&&this.options.detailsUrl;this._addDelegates();this.refreshModel=$.extend(true,{},this._refreshModel,this.element.data("settings"));this.refreshModel.OrderColumns=this._getColumnsOrder();this._currentResultsCount=this.$gridCountContainer.text();this.$pager=this.element.find(this.options.pagerSelector).bsPager({pagerUpdate:$.proxy(this._evOnPageChange,this),pagerGoTop:$.proxy(this._evOnPagerGoTop,this),goTopTitle:this.options.pagerGoTopTitle,dataPageContainer:this.options.pagerDataPageContainer});this.refreshModel.PageSize=parseInt(this.$pager.bsPager("getPageSize"),10)||this.refreshModel.PageSize;this._initialModel.PageSize=this.refreshModel.PageSize;this.needsRefresh=false;if(this.options.sortable&&($.browser==null||$.browser.mobile==false)){this._initSortable()}this.$rowsContainer.find(this.options.rowSelector).each($.proxy(function(b,c){this._initInitialDetails($(c))},this))};a.prototype._initDefaultOptions=function(){if(typeof this.options.filterButtons!=="undefined"&&$.isArray(this.options.filterButtons)){this.options.filterButtons=this.options.filterButtons.concat(this.options.defaultFilterButtons)}else{this.options.filterButtons=this.options.defaultFilterButtons}};a.prototype._addDelegates=function(){if(this.hasDetails){this.element.on("click",this.options.detailsSelector,$.proxy(this._evOnDetailsClick,this));if(this.options.rowClickExpandable){this.element.on("click",this.options.rowSelector,$.proxy(this._onRowClick,this))}}if(this.options.hasOrder){this.element.on("click",this.options.orderContainerSelector+" "+this.options.orderElemSelector,$.proxy(this._evOnOrderChange,this))}if(this.options.hasRowCheck){this.$headerCheck=this.element.find(this.options.headerCheckSelector);this.element.on("click",this.options.rowCheckSelector,$.proxy(this._evOnRowCheckChange,this));this.element.on("change",this.options.headerCheckSelector,$.proxy(this._evOnHeaderCheckSelector,this));for(var b=0;b<this.options.filterButtons.length;b++){var c=this.options.filterButtons[b];(function(e,d){d.$actionsContainer.on("click",e.btnSelector,$.proxy(function(f){f.preventDefault();this.$rowsContainer.find(d.options.rowCheckSelector).parents(d.options.rowSelector).each($.proxy(function(j,i){var g=$(i);var h=e.filter.call(this,g);g.find(this.options.rowCheckSelector).prop("checked",h);h?g.addClass("selected"):g.removeClass("selected")},this));this._evOnRowCheckChange(null,$(f.currentTarget))},d))})(c,this)}if(this.options.gridActions!=null){for(var b=0;b<this.options.gridActions.length;b++){var c=this.options.gridActions[b];(function(j,i){if(j.popover){var d=i.$actionsContainer.find(j.btnSelector);var k="Are you sure?";var h="btn-primary bs-confirm";var f="btn-default bs-cancel";var g="Yes";var e="No";if(typeof j.question!=="undefined"){k=j.question}if(typeof j.confirmButtonText!=="undefined"){g=j.confirmButtonText}if(typeof j.cancelButtonText!=="undefined"){e=j.cancelButtonText}if(typeof j.confirmCssClass!=="undefined"){h=j.confirmCssClass+" bs-confirm"}if(typeof j.cancelCssClass!=="undefined"){f=j.cancelCssClass+" bs-cancel"}d.bsInlineQuestion({placement:"auto",question:k,buttons:[{text:g,cssClass:h,callback:$.proxy(function(){d.bsInlineQuestion("toggle");j.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this)},i)},{text:e,cssClass:f,callback:function(l){d.bsInlineQuestion("toggle")}}]});d.attr("title",d.attr("data-original-title")||"")}else{i.$actionsContainer.on("click",j.btnSelector,$.proxy(function(l){j.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this)},i))}})(c,this)}}}this.element.on("click",".edit_col",$.proxy(this._evOnCellEdit,this));this.element.on("click",this.options.resetGridSelector,$.proxy(this._evResetGrid,this));this.element.on("click",this.options.errorCloseSelector,$.proxy(this._evOnErrorRemove,this));this.element.on("click",this.options.expandToggleSelector,$.proxy(this._evOnExpandToggle,this));this.element.on("click",this.options.addSelector,$.proxy(function(){if(this.options.$toolbar!=null&&typeof this.options.$toolbar.bsToolbar==="function"){this.options.$toolbar.bsToolbar("toggleControl","add")}},this))};a.prototype._initSelectors=function(){this.$rowsContainer=this.element.find(this.options.rowsContainerSelector);this.$gridContainer=this.element.find(this.options.gridContainerSelector);this.$gridCountContainer=this.element.find(this.options.gridCountContainerSelector);this.$filterIcon=this.element.find(this.options.filterSelector);this.$resetGridButton=this.element.find(this.options.resetGridSelector);this.$gridOrderContainer=this.element.find(this.options.orderContainerSelector);this.$actionsContainer=this.element.find(this.options.groupActionsSelector);this.$gridHeader=this.element.find(this.options.gridHeaderSelector);this.$expandToggle=this.element.find(this.options.expandToggleSelector);this.$gridRowsHeader=this.element.find(this.options.gridRowsHeaderSelector);this.$selectorsContainer=this.element.find(this.options.bulkContainerSelector)};a.prototype._createActions=function(e,b){for(var d=0;d<e.length;d++){var c=e[d];if(typeof c.handler!=="function"&&typeof c.init!=="function"){throw"action with selector "+c.btnSelector+" has no click handler and no init handler"}if(typeof c.init==="function"){c.init.call(this,c,b,this)}if(typeof c.handler==="function"){b.on("click",c.btnSelector,{options:c},$.proxy(function(f){var g=f.data.options;g.handler.call(this,f,g,$(f.target).closest(this.options.rowSelector),this)},this))}}};a.prototype.search=function(b,c){if(b.Page){this.refreshModel.Page=b.Page}else{this.refreshModel.Page=1}if(c){this.refreshModel.quickSearch=b;this.refreshModel.Search=null}else{this.refreshModel.Search=b;this.refreshModel.quickSearch=null}this._showFilterIcon();if(c&&this.refreshModel.quickSearch==""){this._hideFilterIcon()}this._getPage()};a.prototype.reset=function(b,c){this.refreshModel.Page=1;this.refreshModel.Search=b;this.refreshModel.quickSearch=null;this._hideFilterIcon();if(c!==true){this._getPage()}};a.prototype.refresh=function(c,b){this._getPage()};a.prototype.add=function(f,d,e){if(typeof this.options.addValidation==="function"){var c=this.options.addValidation.apply(this,[d,e]);if(c===false){return}}var b=$(f);this._currentResultsCount++;this._changeCount();if(this.$rowsContainer.hasClass("no_results")){this.$rowsContainer.removeClass("no_results");this.$rowsContainer.children().remove();this.$gridRowsHeader.closest(".row").show()}this.$rowsContainer.prepend(b.find(this.options.rowSelector));this.$pager.bsPager("updateTotal",this._currentResultsCount);this.toggleBulkActions();this._updateExpandToggle();this.$rowsContainer.show();this.element.find(this.options.noResultsRowSelector).remove()};a.prototype.collapseAll=function(){var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector+".open");b.find(this.options.detailsSelector).trigger("click")};a.prototype.hideBulkActions=function(){if(this.options.hasRowCheck){this.$resetGridButton.hide();this.$actionsContainer.children('button:not([data-ignore="true"])').hide();this.element.find(this.options.headerCheckSelector).parent().hide();this.element.find(this.options.headerCheckSelector).prop("checked",false);this.element.find(this.options.rowCheckSelector).hide();this.element.find(this.options.rowCheckSelector).prop("checked",false);this.element.find(this.options.rowCheckSelector).parents(this.options.rowSelector).removeClass("selected")}};a.prototype.showBulkActions=function(){if(this.options.hasRowCheck){this.element.find(this.options.headerCheckSelector).parent().show();this.element.find(this.options.rowCheckSelector).show()}};a.prototype.showErrors=function(c){if(c.Message){var b=$(this.element).find(".bs-validation_summary");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(b)}this._addError(c.Message,b)}};a.prototype._createDetails=function(){var b=this.element.find(this.options.detailsContainerSelector).each(function(d,c){this._createDetailsHelper($(c))},this)};a.prototype._createDetailsHelper=function(b){var c=b.closest(this.options.rowSelector);if(!c.data("objid")<0){throw"row with index "+c.index()+" has no objId set"}b.prepend('<a href="#" class="expand">&nbsp;</a>');var d=b.find(".expand");d.on("click",this._evOnDetailsClick,this)};a.prototype._evOnDetailsClick=function(f,d){f.preventDefault();f.stopPropagation();var b=$(f.currentTarget).closest(this.options.rowSelector);if(d!=null&&d.removeErrors){if(b.find(this.options.errorCloseSelector).length){b.find(this.options.errorCloseSelector).trigger("click");this._updateExpandToggle();return}}if(b.hasClass("open")){b.removeClass("open");b.children(this.options.rowDetailsSelector).stop(true,true).slideUp(400);this._updateExpandToggle();return}if(b.data("hasdetails")){this._handleDetails(b);return}var g={items:[{Id:b.data("objid"),GetDetails:true}]};this._addAdditionalData(g);this._trigger("beforeGetRowsAjax",0,g);var c={name:this.options.uniqueName+"|details|"+b.data("objId"),url:this.options.detailsUrl,data:g,callbackData:{sent:g,row:b,id:b.data("objid")},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"};$.bforms.ajax(c)};a.prototype._detailsAjaxSuccess=function(c){var b=$(c.RowsHtml);b.find(this.options.rowSelector).each($.proxy(function(f,g){var e=$(g);var d=this._getRowElement(e.data("objid"));d.find(this.options.rowHeaderSelector).replaceWith(e.find(this.options.rowHeaderSelector));d.append(e.find(this.options.rowDetailsSelector).hide());c.$detailsHtml=d.find(this.options.rowDetailsSelector);this._trigger("beforeRowDetailsSuccess",0,{$row:d,data:c});d.stop(true,true).slideDown(800);this._handleDetails(d);d.data("hasdetails",true);this._createActions(this.options.rowActions,d);this._trigger("afterRowDetailsSuccess",0,{$row:d,data:c})},this))};a.prototype._detailsAjaxError=function(e){if(e.Message){var d=arguments[4].row;if(typeof d!=="undefined"&&d!=null){var b=d.find(".bs-validation_row");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row"></div>');d.find(this.options.rowHeaderSelector).after(b)}this._addError(e.Message,b,true);this._updateExpandToggle()}else{var c=$(this.element).find(".bs-validation_summary");if(c.length==0){c=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(c)}this._addError(e.Message,c)}}};a.prototype._expandGridRow=function(b){b.addClass("open");b.find(this.options.rowDetailsSelector).stop(true,true).slideDown(800)};a.prototype._handleDetails=function(d){var c=this.element.find(this.options.rowSelector+".open"),e=false;if(c.length>0&&!this.options.multipleDetails){c.removeClass("open");var b=c.children(this.options.rowDetailsSelector);b.hide();if(this.options.removeDetailsOnCollapse){b.remove();c.data("hasdetails",false)}this._expandGridRow(d);$.bforms.scrollToElement(d);e=true}if(!e){this._expandGridRow(d)}this._updateExpandToggle()};a.prototype._getMultiDetails=function(e,c){var b=this.$rowsContainer.find(this.options.rowSelector).length==c.length?this.$rowsContainer:c,d={items:e};this._addAdditionalData(d);$.bforms.ajax({name:this.options.uniqueName+"|multiDetails",url:this.options.detailsUrl,data:d,callbackData:{items:e},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"})};a.prototype._evOnPageChange=function(c,b){this.refreshModel.Page=b.page;var d=true;if(b.pageSize){this.refreshModel.PageSize=b.pageSize;d=false}this._getPage(d)};a.prototype._evOnPagerGoTop=function(c){var b=$([]);if(this.options.goTopElement!==null){b=$(this.options.goTopElement)}else{b=this.$gridHeader}if(b.length){$.bforms.scrollToElement(b)}};a.prototype._evOnOrderChange=function(c){c.preventDefault();if(!this._currentResultsCount){return}var d=$(c.currentTarget);var k="";var l="";var m=0;if(d.hasClass("sort_asc")){k="sort_desc";m=2}else{if(!d.hasClass("sort_desc")){k="sort_asc";m=1}}var h=d.parent().data("name");var j={Name:h,Type:m};if(this.options.multipleOrder){var b=false;for(var f=0;f<this.refreshModel.OrderableColumns.length;f++){var g=this.refreshModel.OrderableColumns[f];if(g.Name==h){if(m==0){this.refreshModel.OrderableColumns.splice(f,1)}else{g.Type=m}b=true;break}}if(!b){this.refreshModel.OrderableColumns.push(j)}d.removeClass("sort_asc").removeClass("sort_desc")}else{this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc").removeClass("sort_desc");this.refreshModel.OrderableColumns=[];this.refreshModel.OrderableColumns.push(j)}if(m!=0){d.addClass(k)}this._getPage();if(!this._isInitialState()){this._showResetGridButton()}else{this._hideResetGridButton()}};a.prototype._evOnHeaderCheckSelector=function(f){var d=$(f.currentTarget).prop("checked");this.element.find(this.options.rowCheckSelector).prop("checked",d);var b=this.element.find(this.options.rowCheckSelector).parents(this.options.rowSelector);if(d){b.addClass("selected")}else{b.removeClass("selected")}var c=this.$actionsContainer.children('button:not([data-ignore="true"])');if(d){this._showBulkActions(c,b);this._showResetGridButton()}else{c.hide();this._hideResetGridButton()}};a.prototype._evOnRowCheckChange=function(i,f){var c;if(i&&typeof i.stopPropagation=="function"){i.stopPropagation();c=$(i.currentTarget)}else{c=f}if(typeof c!=="undefined"&&c!=null){var d=c.closest(this.options.rowSelector);if(c.prop("checked")){d.addClass("selected")}else{d.removeClass("selected")}}var b=this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).parents(this.options.rowSelector),h=b.length;var g=this.$actionsContainer.children('button:not([data-ignore="true"])');if(h>0){this._showBulkActions(g,b);this._showResetGridButton();if(h==this.element.find(this.options.rowCheckSelector).length){this.$headerCheck.prop("indeterminate",false)}else{this.$headerCheck.prop("indeterminate",true)}this.$headerCheck.prop("checked",true)}else{g.hide();this._resetHeaderCheck();this._hideResetGridButton()}if(i!=null){this._hidePopoverOnRowCheckChange(i)}};a.prototype._showBulkActions=function(b,c){b.each($.proxy(function(f,e){var d=$(e),g=true;if(typeof this.options.beforeShowBulkActionButton==="function"){g=this.options.beforeShowBulkActionButton(d,c)}if(g!==false){d.show()}else{d.hide()}},this))};a.prototype._resetHeaderCheck=function(){if(this.$headerCheck){this.$headerCheck.prop("indeterminate",false);this.$headerCheck.prop("checked",false);this.$actionsContainer.children('button:not([data-ignore="true"])').hide()}};a.prototype._evOnCellEdit=function(d){d.preventDefault();d.stopPropagation();var g=$(d.currentTarget);var f=g.parent().index();var c=this.$gridOrderContainer.children(":eq("+f+")").children("form");var b=c.clone();var h=g.closest(this.options.rowSelector).data("id");b.find("*").each(function(j,i){var e=$(i);if(e.attr("id")){e.attr("id",e.attr("id")+"_"+h+"_"+f)}});g.after(b);g.hide();b.show()};a.prototype._evOnCellSave=function(c){c.preventDefault();var b=$(c.cuurentTarget).closest("form");$.validator.unobtrusive.parse(b);if(!b.valid()){return}var d=b.parseForm()};a.prototype._evResetGrid=function(b){b.stopPropagation();var c=false;this._resetHeaderCheck();this._uncheckAllRows();this._resetOrder();this._hideResetGridButton(true);this._removeErrors();if(this.refreshModel.PageSize!=this._initialModel.PageSize){c=true;this.refreshModel.PageSize=this._initialModel.PageSize;this.$pager.bsPager("selectValue",this.refreshModel.PageSize)}if(this.options.$toolbar!=null&&this.$filterIcon.is(":visible")){this.options.$toolbar.bsToolbar("reset",{preventPagination:false})}else{if(c===true){this.refreshModel.Page=1}this._getPage()}};a.prototype._evOnErrorRemove=function(b){if(this.element.find(".bs-form-error").length==1){window.setTimeout($.proxy(function(){this._hideResetGridButton();this._updateExpandToggle()},this),0)}};a.prototype._evOnExpandToggle=function(d){d.preventDefault();d.stopPropagation();if(this.$expandToggle.hasClass("open")){this.element.find(this.options.detailsSelector).trigger("click",{removeErrors:true})}else{var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var c=$();var f=b.map($.proxy(function(g,h){var e=$(h);if(e.data("hasdetails")){this._handleDetails(e)}else{if(e.find(this.options.errorCloseSelector).length==0){c=c.add(e);return{Id:e.data("objid"),getDetails:true}}}},this)).get();if(f.length){this._getMultiDetails(f,c)}}};a.prototype._onRowClick=function(d){if(!this._isInlineAction(d)&&!this._isTextSelected()){var b=$(d.currentTarget),c=$(d.target).closest(this.options.rowDetailsSelector).length>0,f=$(d.target).closest(".bs-form-error").length>0;if(!c&&!f){b.find(this.options.detailsSelector).trigger("click")}}};a.prototype._getPage=function(d){this.needsRefresh=false;var c=this._serializeRefreshModel();if(typeof this.options.onRefresh==="function"){this.options.onRefresh.call(this,c)}this._addAdditionalData(c);this._trigger("beforePager",c);var b={name:this.options.uniqueName+"|pager",url:this.options.pagerUrl,data:c,callbackData:{sent:c,pageChanged:d},context:this,success:$.proxy(this._pagerAjaxSuccess,this),error:$.proxy(this._pagerAjaxError,this),loadingElement:this.$rowsContainer,loadingDelay:100,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._pagerAjaxSuccess=function(f,e){this._trigger("beforePaginationSuccess",0,f);this._currentResultsCount=f.Count||0;var b=$(f.Html),d=$("<div></div>").append(b);if(this._currentResultsCount){this.$rowsContainer.html(b.html());this.$rowsContainer.removeClass("no_results");this.element.find(this.options.pagerSelector).show();this.$gridRowsHeader.closest(".row").show()}else{this.$rowsContainer.html(d.find(this.options.noResultsRowSelector));this.$rowsContainer.addClass("no_results");this.$gridRowsHeader.closest(".row").hide()}this.$pager.bsPager("update",b.closest(".bs-pages"));if(this._currentResultsCount==0){this.$actionsContainer.hide()}else{this.$actionsContainer.show()}this._changeCount();this._resetHeaderCheck();if(e.pageChanged){$.bforms.scrollToElement(this.$gridHeader)}if(this.refreshModel.DetailsAll||this.refreshModel.DetailsCount>0){var c=this.$rowsContainer.find(this.options.rowSelector);c.each($.proxy(function(g,h){this._initInitialDetails($(h))},this))}this.toggleBulkActions();this._updateExpandToggle();this._trigger("afterPaginationSuccess",0,f)};a.prototype._changeCount=function(){this.$gridCountContainer.html(this._currentResultsCount)};a.prototype._pagerAjaxError=function(c){this._trigger("beforePaginationError",0,c);if(c.Message){var b=$(this.element).find(".bs-validation_summary");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(b)}this._addError(c.Message,b)}if(arguments[4]&&arguments[4].pageChanged){$.bforms.scrollToElement(this.$gridHeader)}this._trigger("afterPaginationError",0,c)};a.prototype._initSortable=function(){this.$gridOrderContainer.find("header").sortable({start:$.proxy(this._onSortStart,this),stop:$.proxy(this._onSortStop,this),update:$.proxy(this._onSortUpdate,this),containment:"parent",distance:10,cursor:"move",tolerance:"pointer",helper:"clone"})};a.prototype._onSortStart=function(b,c){this.$rowsContainer.addClass("loading");c.item.data("startpos",c.item.index());this.element.find(this.options.expandToggleSelector).hide()};a.prototype._onSortStop=function(b,d){var c=d.item.data("startpos");if(c==d.item.index()){this.$rowsContainer.removeClass("loading");this.$expandToggle.show()}};a.prototype._onSortUpdate=function(b,c){this.refreshModel.OrderColumns=this._getColumnsOrder();this._getPage();this.$expandToggle.show()};a.prototype._hidePopoverOnRowCheckChange=function(d){var b=$(d.target);var c=$(".bs-hasInlineQuestion").filter(function(h,g){var e=$(g),i=e.data("bs.popover");if(typeof i!=="undefined"&&i!=null){var f=i.$tip;return f.is(":visible")&&e[0]!=b[0]&&e.find(b).length==0&&b[0]!=f[0]&&f.find(b).length==0}return false});c.bsInlineQuestion("toggle")};a.prototype._showFilterIcon=function(){this.$filterIcon.show();this._showResetGridButton()};a.prototype._hideFilterIcon=function(){this.$filterIcon.hide();this._hideResetGridButton()};a.prototype._showResetGridButton=function(){this.$resetGridButton.show()};a.prototype._hideResetGridButton=function(b){if(this._isInitialState()||b===true){this.$resetGridButton.hide()}};a.prototype._isInitialState=function(){if(this.$filterIcon.is(":visible")){return false}if(this.element.find(this.options.errorCloseSelector).length){return false}var c=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector+'[data-expandedonload="True"]');var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(c);var e=c.filter(function(){return $(this).hasClass("open")}).length,d=b.not(".open").length;if(c.length!=e||b.length!=d){return false}if(this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).length>0){return false}return true};a.prototype._uncheckAllRows=function(){var b=this.element.find(this.options.rowsContainerSelector+">"+this.options.rowSelector);this.element.find(this.options.rowCheckSelector).prop("checked",false);b.removeClass("selected")};a.prototype._resetOrder=function(){this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc sort_desc");this.refreshModel.OrderableColumns=[]};a.prototype._removeErrors=function(){this.element.find(this.options.errorCloseSelector).trigger("click")};a.prototype._updateExpandToggle=function(){if(this.element.find(this.options.detailsSelector).length>0){this.$expandToggle.show()}else{this.$expandToggle.hide()}var c=false;var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var d=b.length-b.find(this.options.errorCloseSelector).length;if(d==0){c=true}if(this._isInitialState()){this._hideResetGridButton()}else{this._showResetGridButton()}if(c){this.$expandToggle.addClass("open")}else{this.$expandToggle.removeClass("open")}};a.prototype._getColumnsOrder=function(){var b=[];this.$gridOrderContainer.find("*[data-name]").each(function(d,c){b.push({key:$(c).data("name"),value:d})});return b};a.prototype._getRowElement=function(b){return this.element.find(this.options.rowSelector+'[data-objid="'+b+'"]')};a.prototype._initInitialDetails=function(b){var c={$detailsHtml:b.find(this.options.rowDetailsSelector)};if(c.$detailsHtml.length){this._trigger("beforeRowDetailsSuccess",0,{$row:b,data:c});this._handleDetails(b);b.data("hasdetails",true);this._createActions(this.options.rowActions,b);this._trigger("afterRowDetailsSuccess",0,{$row:b,data:c})}};a.prototype._isTextSelected=function(){var b="";if(typeof window.getSelection!="undefined"){b=window.getSelection().toString()}else{if(typeof document.selection!="undefined"&&document.selection.type=="Text"){b=document.selection.createRange().text}}return b!==""};a.prototype._isInlineAction=function(b){if($(b.target).hasClass(this.options.inlineActionClass)||$(b.target).parents("."+this.options.inlineActionClass).length>0){return true}return false};a.prototype.toggleBulkActions=function(){if(this.element.find(this.options.rowCheckSelector).length>0){this.element.find(this.options.groupActionsSelector).show()}else{this.element.find(this.options.groupActionsSelector).hide()}};a.prototype._serializeRefreshModel=function(){var b={};for(var d in this.refreshModel){if(d in this.refreshModel){var e=this.refreshModel[d];if(e instanceof Array||typeof(e)!=="object"){b[d]=this.refreshModel[d]}else{for(var c in e){if(c in e){b[c]=e[c]}}}}}return b};a.prototype._addAdditionalData=function(b){if(typeof this.options.additionalData!=="undefined"){$.extend(true,b,this.options.additionalData)}};a.prototype.toggleRowColor=function(g,d,h){var e={};e[true]="rgb(89, 180, 68)";e[false]="rgb(240, 173, 78)";h=h||"objid";var b=(typeof g=="string"||typeof g=="number")?this.element.find(this.options.rowSelector+"[data-"+h+'="'+g+'"]'):g;var c=b.find(".grid_row_color");if(typeof d=="boolean"){d=e[d]}if(typeof d=="undefined"){var f=b.data("active")=="True";d=e[!f]}c.css("background-color",d)};a.prototype.removeRow=function(c,d){d=d||"objid";var b=(typeof c=="string"||typeof c=="number")?this.element.find(this.options.rowSelector+"[data-"+d+'="'+c+'"]'):c;b.remove()};a.prototype.updateRow=function(f,d,e){var c={items:[{Id:f.data("objid"),GetDetails:d||true}]};this._addAdditionalData(c);var b={name:this.options.uniqueName+"|UpdateRow|"+c.objId,url:this.options.detailsUrl,data:c,callbackData:{sent:c,row:f},context:this,success:$.proxy(this._updateRowAjaxSuccess,this),error:$.proxy(this._updateRowAjaxError,this),loadingElement:f,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._updateRowAjaxSuccess=function(c,b){this.updateRows(c.RowsHtml)};a.prototype._updateRowAjaxError=function(d){if(d.Message){var c=arguments[4].row;var b=c.find(this.options.errorRowContainer);if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row"></div>');c.find(this.options.rowHeaderSelector).after(b)}this._addError(d.Message,b,true)}};a.prototype._rowActionAjaxError=function(d,c){if(d.Message){var b=c.find(".bs-validation_row_control");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row_control"></div>');c.find(this.options.rowActionsContainerSelector).before(b)}this._addError(d.Message,b,true)}};a.prototype._addError=function(d,c,e){var b=$('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+d+"</div>");if(e){c.html(b)}else{c.append(b)}this._showResetGridButton()};a.prototype.updateRows=function(d){var b=$(d);var c=b.find(this.options.rowSelector);c.each($.proxy(function(i,k){var f=$(k),j=f.data("objid");var e=this._getRowElement(j);if(this.options.hasRowCheck){var h=e.find(this.options.rowCheckSelector).prop("checked");var g=f.find(this.options.rowCheckSelector);if(g.length){f.find(this.options.rowCheckSelector).prop("checked",h);if(h){f.addClass("selected")}}}e.find(".bs-hasPanel").each(function(o,n){var l=$(n);if(l.hasClass("bs-panelEditMode")){var m=f.find("#"+l.attr("id"));m.replaceWith(l)}});e.replaceWith(f);this._initInitialDetails(f);this._evOnRowCheckChange()},this));this._updateExpandToggle()};a.prototype.getSelectedRows=function(){var c=this.element.find(this.options.rowSelector+".selected");var b=c.map(function(e,f){var d=$(f);return{Id:d.data("objid"),GetDetails:d.hasClass("open")}}).get();return b};a.prototype.enableRowActions=function(c){var b=typeof c==="number"?this._getRowElement(id):c;b.find(this.options.rowActionsContainerSelector).find(".disabled").removeClass("disabled")};a.prototype.disableRowActions=function(c){var b=typeof c==="number"?this._getRowElement(id):c;b.find(this.options.rowActionsContainerSelector).find("button").addClass("disabled")};$.widget("bforms.bsGrid",a.prototype);return a});define("bforms-toolbar",["bforms-toolbar-advancedSearch","bforms-toolbar-add","bforms-toolbar-quickSearch","bforms-toolbar-order","jquery","jquery-ui-core","amplify","bforms-form"],function(b,a,d,c){jQuery.nsx("bforms.toolbar.defaults");jQuery.nsx("bforms.toolbar.controls");$.bforms.toolbar.defaults.AdvancedSearch=b;$.bforms.toolbar.defaults.Add=a;$.bforms.toolbar.defaults.QuickSearch=d;$.bforms.toolbar.defaults.Order=c;var e=function(f){this.options=f;this._create()};e.prototype.options={uniqueName:null,saveTabState:true,tabContainerSelector:".grid_toolbar_form",autoInitControls:true,reset:null,controls:null,controlsOptions:null};e.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"toolbar needs a unique name or the element on which it is aplied has to have an id attr"}this._controls=[];if(this.options.autoInitControls){for(var j in $.bforms.toolbar.defaults){if(j in $.bforms.toolbar.defaults){var g=new $.bforms.toolbar.defaults[j](this.element,this.options.controlsOptions);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}for(var j in $.bforms.toolbar.controls){if(j in $.bforms.toolbar.controls){var g=new $.bforms.toolbar.controls[j](this.element);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}}if(this.options.controls instanceof Array){for(var h=0;h<this.options.controls.length;h++){if(typeof(this.options.controls[h])!="undefined"){var g=new this.options.controls[h](this.element);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}}this.subscribers=new Array();if(this.options.subscribers){this._addSubscribers(this.options.subscribers)}this._addControls(this._controls);this._expandSavedTab()};e.prototype.reset=function(){this._reset(arguments);if(typeof this.options.reset==="function"){this.options.reset.apply(this,arguments)}};e.prototype._reset=function(j){var k=true,l=this.getControl("quickSearch");if(typeof j!=="undefined"){k=j.preventPagination}if(l!=null){l.$element.find("input").val("")}var f=this.getControl("advancedSearch"),g;if(f!=null){f.$container.bsForm("reset");g=f.$container.bsForm("parse")}var m=this.element.data("bformsBsToolbar");for(var h=0;h<m.subscribers.length;h++){m.subscribers[h].bsGrid("reset",g,k)}};e.prototype._addDelegates=function(){};e.prototype.controls=function(h){for(var j=0;j<h.length;j++){var g=h[j];var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}this._addControls(h)};e.prototype._addControls=function(g){if(!g){return}for(var h=0;h<g.length;h++){var f=g[h];if(f.$element){switch(f.type){case"action":this._addAction(f);break;case"tab":this._addTab(f);f.init();break;default:this._addCustomControl(f);f.init();break}}}};e.prototype._addTab=function(f){f.$container=$("#"+f.$element.data("tabid"));f.$element.on("click",{tab:f},$.proxy(this._evBtnTabClick,this))};e.prototype._expandSavedTab=function(){if(this.options.saveTabState){var h=this._getTabs();for(var f=0;f<h.length;f++){var g=h[f];if(amplify.store("slide|"+this.options.uniqueName+"|"+g.options.selector)){g.$element.trigger("click")}}}};e.prototype._addCustomControl=function(f){if(typeof f.name!=="string"||f.name.trim().length==0){throw"all controls must have a name"}if(typeof f.options.selector!=="string"||f.options.selector.trim().length==0){throw"all controls must have a name"}};e.prototype._addAction=function(g){if(typeof g.handler!=="function"){throw"action "+g.name+" must implement an event handler"}var f=this.element.find(g.selector);f.on("click",{buttonOpt:g},$.proxy(this._evBtnClick,this));var h={name:g.name,type:"action",$element:f,options:g};this._controls.push(h)};e.prototype._addSubscribers=function(g){for(var f=0;f<g.length;f++){this._addSubscriber(g[f])}};e.prototype._addSubscriber=function(f){this.subscribers.push(f)};e.prototype._evBtnClick=function(g){g.preventDefault();var f=g.data.buttonOpt;f.handler.call(this,g)};e.prototype._evBtnTabClick=function(g,h){g.preventDefault();var f=g.data.tab;if(this._selectedTab!=null&&this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab)}this._toggleTab(f)};e.prototype._toggleTab=function(h){if(h==null){return}h.$element.toggleClass("selected");if(h.name=="advancedSearch"){var g=this.getControl("quickSearch");if(g!=null){g.$element.toggleClass("selected")}}h.$container.stop(true,false).slideToggle();var f=h.$element.hasClass("selected");if(this.options.saveTabState){amplify.store("slide|"+this.options.uniqueName+"|"+h.options.selector,f)}if(f){this._selectedTab=h}else{this._selectedTab=null}};e.prototype._getTabs=function(){return this._controls.filter(function(f){return f.type=="tab"})};e.prototype.getControl=function(g){var f=$.grep(this._controls,function(h){return h.name==g});if(f!=null&&f[0]!=null){return f[0]}return null};e.prototype.toggleControl=function(g,h){var f=this.getControl(g);if(f!=null&&f.type=="tab"){if(typeof h!=="undefined"){if(h==true){if(this._selectedTab!=null){if(this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab);this._toggleTab(f)}}else{this._toggleTab(f)}}else{if(this._selectedTab!=null&&this._selectedTab.name==f.name){this._toggleTab(f)}}}else{if(this._selectedTab!=null&&this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab)}this._toggleTab(f)}}return f};$.widget("bforms.bsToolbar",e.prototype)});define("bforms-pager",["jquery","jquery-ui-core"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={pagesContainerSelector:".bs-pages",pageSelector:"a[data-page]",dataPageContainer:"page",pageSizeSelector:".bs-perPage",currentPageSelector:"active",disabledPageSelector:"disabled",totalsContainerSelector:".results_number span",pageSizeContainerSelector:".results_per_page",perPageDisplaySelector:".bs-perPageDisplay",goTopButtonSelector:".bs-goTop",goTopTitle:"Go top"};a.prototype._create=function(){this._initElements();this._addDelegates()};a.prototype._initElements=function(){if(typeof $(this.options.goTopButtonSelector)!=="undefined"){$(this.options.goTopButtonSelector).attr("title",this.options.goTopTitle)}};a.prototype._addDelegates=function(){this.element.on("click",this.options.pageSelector,$.proxy(this._evPageChanged,this));this.element.on("click",this.options.pageSizeSelector,$.proxy(this._evPageSizeChanged,this));this.element.on("click",this.options.goTopButtonSelector,$.proxy(this._evGoTopClick,this))};a.prototype._evPageChanged=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parent();if(c.hasClass(this.options.currentPageSelector)||c.hasClass(this.options.disabledPageSelector)){return}this._trigger("pagerUpdate",d,{page:b.data(this.options.dataPageContainer),pageSize:this.element.find(this.options.pageSizeSelector+".selected").data("value")})};a.prototype._evPageSizeChanged=function(b){b.preventDefault();var c=$(b.currentTarget).data("value");this.element.find(".selected").removeClass("selected");$(b.currentTarget).addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>');this._trigger("pagerUpdate",b,{page:1,pageSize:$(b.currentTarget).data("value")})};a.prototype._evGoTopClick=function(b){this._trigger("pagerGoTop",b)};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c)}};a.prototype._btnClickAjaxError=function(){throw"not implemented error handler"};a.prototype.update=function(c){var d=this.element.find(this.options.pageSizeContainerSelector);var b=this.element.find(this.options.pagesContainerSelector);if(b.length>0){b.html(c.children())}else{this.element.html(c)}c.length==0?d.hide():d.show()};a.prototype.updateTotal=function(b){this.element.find(this.options.totalsContainerSelector).html(b)};a.prototype.selectValue=function(c){var b=this.element.find(this.options.pageSizeSelector+'[data-value="'+c+'"]');if(b.length){this.element.find(".selected").removeClass("selected");b.addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>')}};a.prototype.getPageSize=function(){return this.element.find(this.options.pageSizeSelector+".selected").data("value")};$.widget("bforms.bsPager",a.prototype);return a});define("bforms-editable",["jquery","bforms-extensions","jquery-ui-core","bforms-initUI","bforms-ajax"],function(){var a=function(b){this.options=b;this._init()};a.prototype.options={uniqueName:null,isGroup:true,toggles:true,editFirst:false,editOnly:false,headerSelector:"h3",headerSelectorTrigger:"open-editable",saveClass:"btn-success",cancelClass:"btn-danger",readOnlySelector:".bs-readonly",editorSelector:"form",editModeSelector:"bs-edit_mode",url:null,additionalData:{},editSuccessHandler:null,initPlugins:null};a.prototype._init=function(){if(this.element.hasClass("bs-editable_applied")){return}if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"editable needs a unique name or the element on which it is aplied has to have an id attr"}if(!this.options.url){throw"url must have a value"}this._initSelectors();this._addDelegates();if(this.options.toggles){this.element.find(this.options.headerSelector).addClass("editable")}this._createControls();if(typeof this.options.initPlugins==="function"){this.options.initPlugins.call(this)}if(this.options.editFirst||this.options.editOnly){this._switchToEditable()}var b=this.element.bsInitUI();b.done($.proxy(function(){this._trigger("afterFormInit",{editable:this,$element:this.element})},this));this.element.addClass("bs-editable_applied")};a.prototype._initSelectors=function(){this.$readOnly=this.element.find(this.options.readOnlySelector);this.$editor=this.element.find(this.options.editorSelector);this.$header=this.element.find(this.options.headerSelector)};a.prototype._addDelegates=function(){if(this.options.toggles){this.$header.on("click",$.proxy(this._evOnHeaderClick,this))}};a.prototype.initValidation=function(){if(this.$editor.length){$.validator.unobtrusive.parse(this.$editor);this.$editor.validate()}};a.prototype._createControls=function(){if(this.options.editOnly||this.options.toggles){var c=$('<a title="Save"></a>').addClass(this.options.saveClass).addClass("btn").html('<span class="glyphicon glyphicon-ok"></span> ').attr("href","#").on("click",$.proxy(this._evOnSaveClick,this));if(this.options.toggles){var b=$('<a title="Cancel"></a>').addClass(this.options.cancelClass).addClass("btn").html('<span class="glyphicon glyphicon-remove"></span> ').attr("href","#").on("click",$.proxy(this._evOnCancelClick,this))}this.$controls=$("<span></span>").addClass("controls").append(c).append(b).appendTo(this.$header).hide()}};a.prototype._evOnHeaderClick=function(d){d.preventDefault();var b=$(d.currentTarget);var c=$(d.target);if(b.data("editmode")||(!c.hasClass(this.options.headerSelectorTrigger)&&d.currentTarget!=d.target)){return}this._switchToEditable()};a.prototype._evOnSaveClick=function(g){g.preventDefault();var c=$(g.currentTarget);var b=this.$editor;if(b.length>0){$.validator.unobtrusive.parse(b);var h=b.validate();h.settings.partialNameSearch=true;if(!b.valid()){return}}var f=this.options.prefix?b.parseForm(this.options.prefix):b.parseForm();$.extend(true,f,this.options.additionalData);this._trigger("beforeSaveAjax",0,f);f.Type=this.element.data("type");var d={name:this.options.uniqueName,url:this.options.url,data:f,callbackData:{sent:f},context:this,success:$.proxy(this._saveAjaxSuccess,this),error:$.proxy(this._saveAjaxError,this),validationError:$.proxy(this._saveAjaxValidationError,this),loadingElement:this.element,loadingClass:"loading"};$.bforms.ajax(d)};a.prototype._saveAjaxValidationError=function(c,b){if(c){var d=this.$editor.data("validator");d.showErrors(c.Errors,true)}};a.prototype._saveAjaxSuccess=function(c,b){if(typeof this.options.editSuccessHandler==="function"){this.options.editSuccessHandler.call(this,c)}if(this.options.editOnly){return}this.$readOnly.html($(c.Html).html());this._switchToReadOnly()};a.prototype._saveAjaxError=function(b){if(b.Message){var c=this.$editor.data("validator");c.showSummaryError(b.Message)}};a.prototype._evOnCancelClick=function(b){b.preventDefault();this._switchToReadOnly()};a.prototype._switchToEditable=function(){this.$readOnly.hide();this.$editor.show();this.$controls.show();this.$header.data("editmode",true);this.$header.removeClass("editable")};a.prototype._switchToReadOnly=function(){this.$readOnly.show();this.$editor.hide();this.$controls.hide();this.$header.data("editmode",false);this.$header.addClass("editable")};a.prototype._destroy=function(){this.element.removeClass("bs-editable_applied")};$.widget("bforms.bsEditable",a.prototype);return a});define("bforms-form",["jquery","bforms-extensions","jquery-ui-core","bforms-validate-unobtrusive","bforms-initUI","bforms-ajax","amplify"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={uniqueName:null,hasGroupToggle:true,style:{},focusFirst:true,saveGroupContainerState:true,appendUrlToUniqueName:true,groupToggleSelector:".bs-group_toggle",groupToggleContainerSelector:".bs-group_toggle_container",groupToggleUp:"glyphicon-chevron-up",groupToggleDown:"glyphicon-chevron-down",glyphClass:".glyphicon",actions:[]};a.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"form needs a unique name or the element on which it is aplied has to have an id attr"}this._buttons=new Array();this._initSelectors();this._addDelegates();this._initAmplifyStore();this._addActions(this.options.actions);var b=this.$form.bsInitUI(this.options.style);b.done($.proxy(function(){this._trigger("afterInitUI",0,{name:this.options.uniqueName,form:this.$form})},this))};a.prototype._initSelectors=function(){this.$form=this.element.is("form")?this.element:this.element.find("form")};a.prototype._addDelegates=function(){if(this.options.hasGroupToggle){this.element.find(this.options.groupToggleSelector).on("click",$.proxy(this._evToggleGroup,this))}};a.prototype._initAmplifyStore=function(){if(this.options.saveGroupContainerState){var b=this._getKeyForGroupContainer();if(amplify.store(b)){try{var d=amplify.store(b);this.$form.find(this.options.groupToggleContainerSelector).each(function(e){if(d[e]){$(this).next().show()}else{$(this).next().hide()}})}catch(c){console.warn("Error on saving on local storage:"+c)}}}};a.prototype._addActions=function(b){if(b){for(var c=0;c<b.length;c++){this._addAction(b[c])}}};a.prototype._addAction=function(c){var b=this.element.find(c.selector);if(b.length==0){throw"element with selector "+c.selector+" is not found in form container "+this.options.uniqueName}b.on("click",{buttonOpt:c,handlerContext:this.options.handlerContext},$.proxy(this._evBtnClick,this));this._buttons.push({name:c.name,elem:b})};a.prototype._evBtnClick=function(g){g.preventDefault();var b=$(g.currentTarget);var d=g.data.buttonOpt;var h=g.data.handlerContext;if(d.validate&&!this._validate()){return}var i=this.$form.validate();var f;if(d.parse){f=this._parse();if(typeof d.getExtraData==="function"){d.getExtraData.call(this,f)}this._trigger("beforeFormSubmit",0,{$button:b,buttonOpt:d,data:f})}var c=b.data("action")||d.actionUrl;if(c){$.bforms.ajax({name:this.options.uniqueName,url:c,data:f,callbackData:{handler:d.handler,handlerContext:h,sent:f},context:this,success:$.proxy(this._btnClickAjaxSuccess,this),error:$.proxy(this._btnClickAjaxError,this),loadingElement:this.element,loadingClass:"loading",validationError:function(e){if(e!=null&&e.Errors!=null){if(typeof i==="undefined"){$.validator.unobtrusive.parse(this.$form);i=this.$form.validate()}i.showErrors(e.Errors,true)}}})}else{if(typeof d.handler!=="function"){throw"action "+d.name+" must implement an event handler or have an url option"}d.handler.call(this,f)}};a.prototype._parse=function(){return this.element.parseForm(this.options.prefix?this.options.prefix:"")};a.prototype._evToggleGroup=function(c){var b=$(c.currentTarget);b.find(this.options.glyphClass).toggleClass(this.options.groupToggleUp).toggleClass(this.options.groupToggleDown);b.toggleClass("open").closest(this.options.groupToggleContainerSelector).next().stop().slideToggle($.proxy(this._saveGroupContainer,this))};a.prototype._saveGroupContainer=function(){if(this.options.saveGroupContainerState){try{var c=[];var b=this._getKeyForGroupContainer();this.$form.find(this.options.groupToggleContainerSelector).each(function(){c.push($(this).next().is(":visible"))});amplify.store(b,c)}catch(d){console.warn("Error on saving on local storage:"+d)}}};a.prototype._validate=function(){this.$form.removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(this.$form);var b=this.$form.validate();this._trigger("beforeFormValidation",0,{validator:b,form:this.$form,name:this.options.uniqueName});return this.$form.valid()};a.prototype._getAction=function(b){return $.grep(this._buttons,function(c,d){return c.name==b})[0]};a.prototype._getKeyForGroupContainer=function(){return this.options.appendUrlToUniqueName?"groupContainer|"+this.options.uniqueName+"|"+location.host+location.pathname:"groupContainer|"+this.options.uniqueName};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c,this)}};a.prototype._btnClickAjaxError=function(b){if(b.Message){var c=this.$form.data("validator");c.showSummaryError(b.Message)}};a.prototype.getFormData=function(b){var c=this.element.find("form");c.removeData("validator");c.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(c);var d=c.validate();this._trigger("beforeFormValidation",0,{validator:d,form:c,name:this.options.uniqueName});if(c.valid()){b=this._parse()}};a.prototype.parse=function(b){return this._parse()};a.prototype.triggerAction=function(c){var b=this._getAction(c);if(b!=null){b.elem.trigger("click")}};a.prototype.reset=function(b){this.element.bsResetForm(this.options.focusFirst)};$.widget("bforms.bsForm",a.prototype);return a});define("bforms-toolbar-advancedSearch",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="advancedSearch";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_advanced_search"};a.prototype.init=function(){var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}var b=this.$container.find(this._defaultOptions.selector);var e=$.extend(true,this.options,{container:b.attr("id"),actions:c});this.$searchForm=this.$container.bsForm(e)};a.prototype._addDefaultOptions=function(){var c={name:"search",selector:".js-btn-search",validate:false,parse:true,handler:$.proxy(this._evOnSearch,this)};this._controls.search=c;var b={name:"reset",selector:".js-btn-reset",validate:false,parse:true,handler:$.proxy(this._evOnReset,this)};this._controls.reset=b};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnSearch=function(b){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("search",b)}};a.prototype._evOnReset=function(){this.$searchForm.bsForm("reset");var b={};this.$searchForm.bsForm("getFormData",b);for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("reset",b)}};return a});define("bforms-toolbar-add",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="add";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_add"};a.prototype.init=function(){var b=this.$container.find(this._defaultOptions.selector);var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}var e=$.extend(true,this.options,{container:b.attr("id"),actions:c});this.$addForm=this.$container.bsForm(e)};a.prototype._addDefaultOptions=function(){var b={name:"save",selector:".js-btn-save",validate:true,parse:true,handler:$.proxy(this._evOnAdd,this)};this._controls.save=b;var c={name:"reset",selector:".js-btn-reset",validate:false,parse:false,handler:$.proxy(this._evOnReset,this)};this._controls.reset=c};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnAdd=function(b,d){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("add",d.Row,b,d)}this.$addForm.bsForm("reset")};a.prototype._evOnReset=function(b){this.$addForm.bsForm("reset")};return a});define("bforms-toolbar-quickSearch",["jquery"],function(){var a=function(b,c){this.name="quickSearch";this.type="custom";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c)};a.prototype._defaultOptions={selector:".bs-quick_search",instant:true,timeout:250};a.prototype.init=function(){this.widget=this.$toolbar.data("bformsBsToolbar");this.$toolbar.on("keyup",this.options.selector+" .bs-text",$.proxy(this._evOnQuickSearchKeyup,this))};a.prototype._evOnQuickSearchKeyup=function(d){var b=$(d.currentTarget);var f=b.val().trim();if(f.length==0&&b.data("empty")){return}var c=this.widget.getControl("advancedSearch");if(c!=null&&c.$element.hasClass("selected")){c.$element.trigger("click")}if(f.length==0){b.data("empty",true)}else{b.data("empty",false)}if(this.options.instant){window.clearTimeout(this.quickSearchTimeout);this.quickSearchTimeout=window.setTimeout($.proxy(function(){this._search(f)},this),this.options.timeout)}else{if(d.which==13||d.keyCode==13){this._search(f)}}};a.prototype._search=function(c){for(var b=0;b<this.widget.subscribers.length;b++){this.widget.subscribers[b].bsGrid("search",c,true)}};return a});define("bforms-toolbar-order",["jquery","bforms-toolbar","bforms-form","bforms-sortable"],function(){var a=function(b,c){this.options=$.extend(true,{},this._defaultOptions,c);this.name="order";this.type="tab";this.$toolbar=b;this.widget=b.data("bformsBsToolbar");this._controls={};this.updated=false;this.currentConnection={};this._addDefaultControls()};a.prototype.init=function(){var b=this.$container.find(this.options.selector);var c=[];for(var d in this._controls){if(this._controls.hasOwnProperty(d)){c.push(this._controls[d])}}this.$orderForm=this.$container.bsForm({container:b.attr("id"),actions:c});this.$sortable=$(this.options.containerSelector);this.bsSortableOptions={itemSelector:this.options.itemSelector,listSelector:this.options.listSelector,containerSelector:this.options.containerSelector,serialize:this.options.serialize};this.$sortable.bsSortable(this.bsSortableOptions);this.previousConfigurationHtml=this.$sortable.html();this._addDelegates()};a.prototype._defaultOptions={selector:".bs-show_order",itemSelector:".bs-sortable-item",listSelector:".bs-sortable",containerSelector:".sortable-container",serialize:"array"};a.prototype._addDefaultControls=function(){this._controls.reset={name:"reset",selector:".js-btn-reset",validate:false,parse:false,handler:$.proxy(this._evOnReset,this)};this._controls.save={name:"save",selector:".js-btn-save_order",validate:false,parse:false,handler:$.proxy(this._evOnSave,this)}};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._addDelegates=function(){$(this.options.containerSelector).on("update",$.proxy(this._evOnUpdate,this))};a.prototype._evOnUpdate=function(b){this.reorderedList=b.updatedList;this.updated=true};a.prototype._evOnReset=function(){this.$sortable.html(this.previousConfigurationHtml);$(".placeholder").remove();this.$sortable.bsSortable(this.bsSortableOptions)};a.prototype._evOnSave=function(){if(this.updated){$(this._controls.save.selector).attr("disabled",true);this.$orderForm.attr("disabled",true);var b=this.reorderedList;var c=$(this._controls.save.selector).data("url");$(".loading-global").show();$.bforms.ajax({data:{model:b},url:c,success:this._reorderSuccess,error:this._reorderError,context:this,loadingClass:".loading-global"})}};a.prototype._reorderError=function(b){$(".loading-global").hide();this.$orderForm.removeAttr("disabled");$(this._controls.save.selector).attr("disabled",false);this.updated=false};a.prototype._reorderSuccess=function(b){this.updated=false;$(".loading-global").hide();this.$orderForm.removeAttr("disabled");$(this._controls.save.selector).attr("disabled",false);this.previousConfigurationHtml=this.$sortable.html()};return a});define("bforms-groupEditor",["jquery","jquery-ui-core","bforms-pager","bforms-ajax","bforms-namespace","bforms-inlineQuestion","bforms-form"],function(){var a=function(b){this.options=$.extend(true,{},this.options,b);this._init()};a.prototype.options={uniqueName:"",tabsSelector:".bs-tabs",groupsSelector:".bs-groups",groupSelector:".bs-group",navbarSelector:".bs-navbar",toolbarBtnSelector:".bs-toolbarBtn",editorFormSelector:".bs-editorForm",pagerSelector:".bs-pager",tabContentSelector:".bs-tabContent",tabItemSelector:".bs-tabItem",tabItemsListSelector:".bs-tabItemsList",groupBulkMoveSelector:".bs-moveToGroupBtn",groupEditorFormSelector:".bs-groupForm",groupItemSelector:".bs-groupItem",groupItemTemplateSelector:".bs-itemTemplate",groupItemContentSelector:".bs-itemContent",groupItemsWrapper:".bs-itemsWrapper",groupItemsCounter:".bs-counter",tabInlineSearch:".bs-tabInlineSearch",removeBtn:".bs-removeBtn",addBtn:".bs-addBtn",editBtn:".bs-editBtn",upBtn:".bs-upBtn",downBtn:".bs-downBtn",toggleExpandBtn:".bs-toggleExpand",resetBtn:".bs-resetGroupEditor",saveBtn:".bs-saveGroupEditor",getTabUrl:""};a.prototype._init=function(){this.$element=this.element;if(!this.options.uniqueName){this.options.uniqueName=this.$element.attr("id")}if(!this.options.uniqueName){throw"grid needs a unique name or the element on which it is aplied has to have an id attr"}this._initOptions();this._initSelectors();this._initComponents();this._addDelegates();this._initSelectedTab();this._initTemplates();this._initSortable();this._initGroupItemForms()};a.prototype._initComponents=function(){this._countGroupItems();this._checkEditable()};a.prototype._initOptions=function(){this.options.saveUrl=this.options.saveUrl||this.$element.find(this.options.saveBtn).attr("href")};a.prototype._initSelectors=function(){this.$navbar=this.$element.find(this.options.navbarSelector);this.$tabs=this.$element.find(this.options.tabsSelector);this.$groups=this.$element.find(this.options.groupsSelector);this.$counter=this.$groups.find(this.options.groupItemsCounter);this.$groupForm=this.$element.find(this.options.groupEditorFormSelector)};a.prototype._addDelegates=function(){this.$navbar.on("click","a",$.proxy(this._evChangeTab,this));this.$tabs.find("div[data-tabid]").on("click","button"+this.options.toolbarBtnSelector,$.proxy(this._evChangeToolbarForm,this));this.$tabs.on("click",this.options.addBtn,$.proxy(this._evAdd,this));this.$groups.on("click",this.options.removeBtn,$.proxy(this._evRemove,this));this.$groups.on("click",this.options.editBtn,$.proxy(this._evEdit,this));this.$groups.on("click",this.options.upBtn,$.proxy(this._evUp,this));this.$groups.on("click",this.options.downBtn,$.proxy(this._evDown,this));this.$groups.on("click",this.options.toggleExpandBtn,$.proxy(this._evToggleExpand,this));this.$element.on("click",this.options.resetBtn,$.proxy(this._evResetClick,this));this.$element.on("click",this.options.saveBtn,$.proxy(this._evSaveClick,this));this.$tabs.on("click",this.options.groupBulkMoveSelector,$.proxy(this._evBulkMoveClick,this))};a.prototype._initSelectedTab=function(){this._initTab(this._getSelectedTab())};a.prototype._initTemplates=function(){this.element.find(this.options.groupSelector).each($.proxy(function(e,d){var b=$(d),c=b.find(this.options.groupItemTemplateSelector);b.data("template",c.children(":first").clone());c.remove()},this))};a.prototype._initTab=function(f,d){var e=this;if(f){var c=true;if(!f.loaded){c=false;this._ajaxGetTab({tabModel:f,data:{settings:{TabId:f.tabId}}})}if(f.html){f.container.find(this.options.tabContentSelector).html(f.html)}if(!f.pager){f.pager=f.container.find(this.options.pagerSelector);f.pager.bsPager({pagerUpdate:function(h,g){e._evChangePage(g,f)},pagerGoTop:$.proxy(this._evGoTop,this)})}if(d!==true){f.container.show()}if(c){this._checkItems()}if(f.container.data("init")!==true){this._trigger("onTabInit",0,f);var b=f.container.find(this.options.editorFormSelector);b.each($.proxy(function(i,h){var g=$(h),j=g.data("uid");if(typeof this.options.initEditorForm==="function"){this.options.initEditorForm(g,j,f)}},this));f.container.on("change",this.options.tabInlineSearch,$.proxy(this._evInlineSearch,this,f))}f.container.data("init",true);this._initDraggable(f)}};a.prototype._initSortable=function(){this.$element.find(this.options.groupSelector).find(this.options.groupItemsWrapper).sortable({items:this.options.groupItemSelector,distance:5,connectWith:this.options.groupSelector,start:$.proxy(this._sortStart,this),beforeStop:$.proxy(this._beforeSortStop,this),stop:$.proxy(this._sortStop,this)})};a.prototype._initDraggable=function(b){b.container.find(this.options.tabItemSelector).each($.proxy(function(d,e){var c=$(e);this._checkItem(c,b.tabId,b.connectsWith);c.draggable(this._getDraggableOptions(b))},this))};a.prototype._initGroupItemForms=function(){if(this.$groupForm.length){this.$groupForm.bsForm({uniqueName:"groupEditorForm"})}var b=this.$element.find(this.options.groupsSelector).find(this.options.editorFormSelector);b.each($.proxy(function(d,c){this._initGroupItemForm($(c))},this))};a.prototype._initGroupItemForm=function(b){b.bsForm({uniqueName:b.data("uid")})};a.prototype._evUp=function(d){d.preventDefault();var b=$(d.currentTarget).parents(this.options.groupItemSelector).first(),c=b.prevAll(this.options.groupItemSelector).first(),f=(b.outerHeight()+window.parseInt(b.css("margin-bottom"))),h=c.outerHeight()+window.parseInt(c.css("margin-top")),g=Math.min(f,h);if(c.length>0){b.animate({top:-g});c.animate({top:g},function(){c.css("top","auto");b.css("top","auto");c.before(b)});this._rebuildNumbers()}else{this._shakeElement(b)}};a.prototype._evDown=function(d){d.preventDefault();var b=$(d.currentTarget).parents(this.options.groupItemSelector).first(),c=b.nextAll(this.options.groupItemSelector).first(),f=(b.outerHeight()+window.parseInt(b.css("margin-bottom"))),i=(c.outerHeight()+window.parseInt(c.css("margin-top"))),h=Math.min(f,i);var g=b.css("z-index"),k=c.css("z-index");var j=window.parseInt(k,10);if(!window.isNaN(j)){b.css("z-index",j+1)}else{b.css("z-index",16777271);c.css("z-index",16777270)}if(c.length>0){b.animate({top:h});c.animate({top:-h},function(){b.css("z-index",g);c.css("z-index",k);c.css("top","auto");b.css("top","auto");c.after(b)});this._rebuildNumbers()}else{this._shakeElement(b)}};a.prototype._evBulkMoveClick=function(d){var g=$(d.currentTarget).data("groupid");var c=this._getSelectedTab(),b=c.container.find(this.options.tabItemSelector),f=false;b.each($.proxy(function(h,i){var e=$(i);f=this.addToGroup({objId:e.data("objid"),itemModel:e.data("model"),tabId:c.tabId},g,true)||f},this));if(!f){this._showMoveError(this.$element)}d.preventDefault()};a.prototype._evToggleExpand=function(f){f.preventDefault();var c=$(f.currentTarget),d=c.parents("[data-groupid]"),b=d.find(this.options.groupItemsWrapper);b.toggle("fast",$.proxy(function(){d.find(this.options.toggleExpandBtn).toggleClass("open")},this))};a.prototype._evChangeToolbarForm=function(d){d.preventDefault();var c=$(d.currentTarget),g=c.data("uid"),f=this._getSelectedTab(),b=f.container,h=b.find("div[data-uid]:visible"),i=h.data("uid");h.slideUp();if(i!=g){b.find("div[data-uid='"+g+"']").slideDown()}};a.prototype._evChangeTab=function(f){f.preventDefault();var c=$(f.currentTarget),h=c.data("tabid"),b=this._getTab(h),g=this._isLoaded(b),d=b.data("connectswith");this._hideTabs();this._initTab({container:b,loaded:g,tabId:h,connectsWith:d})};a.prototype._evChangePage=function(b,c){this._ajaxGetTab({tabModel:c,data:{settings:{Page:b.page,PageSize:b.pageSize||5,TabId:c.tabId}}})};a.prototype._evGoTop=function(b){b.preventDefault();$.bforms.scrollToElement(this.$element.find(this.options.navbarSelector))};a.prototype._evRemove=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parents(this.options.groupItemSelector),g=c.data("tabid"),f=c.data("objid");c.effect("drop",function(){c.remove()});this._toggleItemCheck(this._getTabItem(g,f),true);this._countGroupItems()};a.prototype._evAdd=function(g){g.preventDefault();var b=$(g.currentTarget),d=b.parents(this.options.tabItemSelector),h=d.data("objid"),j=this._getSelectedTab(),i=j.tabId,f=j.connectsWith,c=this._getGroups(f);$.each(c,$.proxy(function(n,m){var e=$(m);if(!this._isInGroup(h,i,e)){var l=true,p=this._getTabItem(i,h),o=p.data("model");if(typeof this.options.validateMove==="function"){var q=this.options.validateMove(o,i,e);l=typeof q==="boolean"?q:true}if(l){var k=this._getGroupItemTemplate($(m),i,h,o);var r=this._renderGroupItem(o,m,i,h);k.find(this.options.groupItemContentSelector).html(r);this._checkEditableItem(k);this._initGroupItemForm(k.find(this.options.editorFormSelector));e.find(this.options.groupItemsWrapper).append(k);this._trigger("onTabItemAdd",0,{model:o,tabId:i,$row:k,$group:e});d.effect("transfer",{to:e.find(k)});this._checkItem(this._getTabItem(i,h),i,f);return false}}},this));this._countGroupItems()};a.prototype._evEdit=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parents(this.options.groupItemSelector),g=c.data("objid"),h=c.data("tabid"),f=c.parents("[data-groupid]").data("groupid");throw"[objId: "+g+", groupId: "+f+", tabId: "+h+"] . not implemented yet"};a.prototype._evResetClick=function(b){this.reset();b.preventDefault();b.stopPropagation()};a.prototype._evSaveClick=function(c){c.preventDefault();c.stopPropagation();var d=this.parse();if(d.valid){var b=d.data;if(typeof this.options.additionalData!=="undefined"){$.extend(true,b,this.options.additionalData)}this._trigger("beforeSaveAjax",0,b);this._ajaxSaveGroup(b)}};a.prototype._evInlineSearch=function(f,c){var b=$(c.currentTarget),d=b.val();f.QuickSearch=d;this.search(f)};a.prototype._ajaxSaveGroup=function(b){$.bforms.ajax({name:this.options.uniqueName+"|saveGroupEditor",url:this.options.saveUrl,data:b,callbackData:b,context:this,success:$.proxy(this._ajaxSaveGroupSuccess),error:$.proxy(this._ajaxSaveGroupError),loadingElement:this.$element,loadingClass:"loading"})};a.prototype._ajaxSaveGroupSuccess=function(c,b){this._trigger("onSaveSuccess",0,arguments)};a.prototype._ajaxSaveGroupError=function(){this._trigger("onSaveError",0,arguments)};a.prototype._ajaxGetTab=function(c){if(typeof this.options.additionalData!=="undefined"){$.extend(true,c.data,this.options.additionalData)}this._trigger("beforeGetTab",0,c);var b={name:this.options.uniqueName+"|getTab|"+c.tabModel.tabId,url:this.options.getTabUrl,data:c.data,callbackData:c,context:this,success:$.proxy(this._ajaxGetTabSuccess,this),error:$.proxy(this._ajaxGetTabError,this),loadingElement:c.tabModel.container,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._ajaxGetTabSuccess=function(d,c){if(d){this._trigger("onGetTabSuccess",0,arguments);var b=c.tabModel.container;b.data("loaded","true");if(d.Html){this._initTab({container:b,loaded:true,html:d.Html,tabId:c.tabModel.tabId,connectsWith:b.data("connectswith")},c.data.preventShow)}}};a.prototype._ajaxGetTabError=function(){console.trace();this._trigger("onGetTabError",0,arguments)};a.prototype._checkEditable=function(){$.each(this._getGroupItems(),$.proxy(function(b,c){this._checkEditableItem($(c))},this))};a.prototype._checkEditableItem=function(b){if(this._isTabEditable(b.data("tabid"))){b.find(this.options.editBtn).show()}};a.prototype._rebuildNumbers=function(){};a.prototype._shakeElement=function(b){b.effect("shake",{times:2,direction:"up",distance:10},50)};a.prototype._countGroupItems=function(){this.$counter.html(this._getGroupItems().length)};a.prototype._checkItem=function(b,d,c){if(this._isItemSelected(b.data("objid"),d,c,b.data("model"))){this._toggleItemCheck(b,false)}};a.prototype._checkItems=function(){var c=this._getSelectedTab(),b=c.container.find(this.options.tabItemSelector);$.each(b,$.proxy(function(d,e){this._checkItem($(e),c.tabId,c.connectsWith)},this))};a.prototype._isItemSelected=function(h,i,d,g){var b=this._getGroups(d),c=0,e=0;$.each(b,$.proxy(function(m,l){var j=$(l),n=this._isInGroup(h,i,j),k=true;if(typeof this.options.validateMove==="function"){var o=this.options.validateMove(g,i,j);k=typeof o==="boolean"?o:true}if(k){c++}if(n){e++}},this));var f=this.getItemCount(h);return(c>0||f>0)?(c==0?(c+f===e):c===e):false};a.prototype._isInGroup=function(e,f,b){var d=false,c=b.find(this.options.groupItemSelector);$.each(c,function(h,i){var g=$(i);if(g.data("objid")==e&&g.data("tabid")==f&&!g.hasClass("temp-sortable")){d=true;return false}});return d};a.prototype._toggleItemCheck=function(c,e){var b=c.find("span.glyphicon"),d=this.options.addBtn.replace(".","");if(e&&!c.hasClass("selected")){return false}if(!e&&c.hasClass("selected")){return false}c.toggleClass("selected");b.parents("a:first").toggleClass(d);if(b.hasClass("glyphicon-ok")){b.removeClass("glyphicon-ok").addClass("glyphicon-plus")}else{b.removeClass("glyphicon-plus").addClass("glyphicon-ok")}this._trigger("afterToggleItem",0,arguments)};a.prototype._uncheckAllItems=function(){var b=this.$element.find(this.options.tabItemSelector+".selected");b.each($.proxy(function(c,d){this._toggleItemCheck($(d),true)},this))};a.prototype._getSelectedTab=function(){var b=this.$tabs.find("div[data-tabid]:visible"),e=b.data("tabid"),c=b.data("connectswith"),d=this._isLoaded(b);return{container:b,tabId:e,connectsWith:c,loaded:d}};a.prototype._hideTabs=function(){var b=this.$tabs.find("div[data-tabid]");b.hide()};a.prototype._isLoaded=function(b){var c=b.data("loaded");return c=="true"||c=="True"||c==true};a.prototype._getTab=function(b){return this.$tabs.find('div[data-tabid="'+b+'"]')};a.prototype._isTabEditable=function(b){return this._getTab(b).data("editable")};a.prototype._getTabItem=function(e,d){var b=this._getTab(e),c=b.find(this.options.tabItemSelector+'[data-objid="'+d+'"]');return c};a.prototype._getGroup=function(b){return this.$groups.find('div[data-groupid="'+b+'"]')};a.prototype._getGroupItems=function(){return this.$groups.find(this.options.groupItemSelector+":not("+this.options.groupItemTemplateSelector+" >)")};a.prototype._getGroups=function(c){var b;if(c){b=[];$.each(c,$.proxy(function(e,d){b.push(this._getGroup(d))},this))}else{b=this.$groups.find("div[data-groupid]")}return b};a.prototype._getGroupItemTemplate=function(b,g,f,e){var h=b.data("template").clone();h.data("objid",f);h.data("tabid",g);h.data("model",e);var d=h.html();d=d.replace(/__tabid__/gi,g);d=d.replace(/{{tabid}}/gi,g);d=d.replace(/__objid__/gi,g);d=d.replace(/{{objid}}/gi,f);h.html(d);var c={template:h};this._trigger("afterGetGroupItemTemplate",0,c);return c.template};a.prototype._renderGroupItem=function(c,b,e,d){if(typeof this.options.buildGroupItem==="function"){return this.options.buildGroupItem(c,b,e,d)}else{if(typeof c.Name==="undefined"){throw"No buildGroupItem method define and no Name property found on object"}else{return c.Name}}};a.prototype._getDraggableOptions=function(b){return{distance:5,connectToSortable:this._buildConnectsWithSelector(b.connectsWith),helper:typeof this.options.buildDragHelper==="function"?$.proxy(this._buildDragElement,this):"clone",cursorAt:{top:typeof this.options.getCursorAtTop==="function"?this.options.getCursorAtTop(b):0,left:typeof this.options.getCursorAtLeft==="function"?this.options.getCursorAtLeft(b):0,},start:$.proxy(this._dragStart,this),stop:$.proxy(this._dragStop,this),cancel:".selected"}};a.prototype._buildDragElement=function(g){var b=$(g.currentTarget),h=b.data("model"),d=b.parents("[data-tabid]"),i=d.data("tabid"),f=d.data("connectswith");var c=$(this.options.buildDragHelper(h,i,f));return c};a.prototype._buildConnectsWithSelector=function(b){var d="";for(var c in b){d+=this.options.groupSelector+'[data-groupid="'+b[c]+'"] '+this.options.groupItemsWrapper;if(c<b.length-1){d+=", "}}return d};a.prototype._dragStart=function(f,g){var b=$(f.target),c=b.parents("[data-connectswith]"),d=c.data("connectswith");this._dragging=true;this._addOpacity(d);this._trigger("onDragStart",0,arguments)};a.prototype._dragStop=function(){this._dragging=false;this._removeOpacity();this._trigger("onDragStop",0,arguments)};a.prototype._sortStart=function(c,f){var b=f.item,d=b.parents(this.options.groupSelector).data("groupid");b.data("groupid",d).addClass("temp-sortable");this._trigger("onSortStart",0,arguments)};a.prototype._beforeSortStop=function(b,c){};a.prototype._sortStop=function(h,r){this._trigger("onSortStop",0,arguments);var c=r.item,b=c.parents(this.options.groupSelector).first(),p=this._getSelectedTab(),g=p.connectsWith||[],l=c.data("model"),o=p.tabId,i=b.data("groupid"),m=c.data("objid");this._removeOpacity();var k=this._isInGroup(m,o,b),j=g.indexOf(i)!==-1,f=j&&!k;if(this._dragging!==true){var n=c.data("groupid"),q=b.data("groupid");if(n==q){return}}c.removeData("groupid").removeClass("temp-sortable");if(typeof this.options.validateMove==="function"){var s=this.options.validateMove(l,o,b);f=typeof s==="boolean"?s:f}if(f){var d=this._getGroupItemTemplate(b,o,m,l);var t=this._renderGroupItem(l,b,o,m);d.find(this.options.groupItemContentSelector).html(t);this._initGroupItemForm(d.find(this.options.editorFormSelector));this._checkEditableItem(d);r.item.replaceWith(d);this._trigger("onTabItemAdd",0,{model:l,tabId:o,$row:d,$group:b});this._checkItem(this._getTabItem(o,m),o,g)}else{this._showMoveError(b);if(!this._dragging){return false}else{r.item.remove()}}};a.prototype._showMoveError=function(b){if(typeof this.options.showMoveError==="function"){this.options.showMoveError(b)}else{this.$element.css({cursor:"not-allowed"});window.setTimeout($.proxy(function(){this.$element.css({cursor:""})},this),300)}};a.prototype._addOpacity=function(c){var b=this.$element.find(this.options.groupSelector);c=c||[];b.each(function(f,e){var d=$(e),g=d.data("groupid");if(c.indexOf(g)===-1){d.css("opacity","0.3")}})};a.prototype._removeOpacity=function(){var b=this.$element.find(this.options.groupSelector);b.css("opacity","1")};a.prototype.parse=function(){var i={},c=this.$groups.find(this.options.groupSelector),h=true;c.each($.proxy(function(o,l){var j=$(l),n=j.data("propertyname"),m={Items:[]};var k=j.find(this.options.groupItemSelector).filter($.proxy(function(p,q){return $(q).parents(this.options.groupItemTemplateSelector).length==0},this));k.each($.proxy(function(t,s){var q=$(s),u={};u.Id=q.data("objid");u.TabId=q.data("tabid");var p=q.find(this.options.editorFormSelector);if(p.length){var v="prefix"+p.data("uid")+".";p.find("form").removeData("validator").removeData("unobstrusiveValidation");$.validator.unobtrusive.parse(p.find("form"));var x=p.find("form").validate(),r=p.find("form").valid(),w={validator:x,valid:r,$form:p,$item:q,$group:j};this._trigger("onGroupItemFormValidation",w);h=h&&w.valid;$.extend(true,u,p.parseForm(v))}this._trigger("getExtraItemData",0,[u,q,j]);m.Items.push(u)},this));this._trigger("getExtraGroupData",0,[m,j]);i[n]=m},this));if(this.$groupForm.length){var d=this.$groupForm.parseForm();i.form=d;var b=this.$groupForm.find("form");if(b.length){$.validator.unobtrusive.parse(b);var f=b.validate(),g=b.valid();var e={$form:b,valid:g,validator:validator};this._trigger("onGroupFormValidation",e);h=h&&e.valid}}return{data:i,valid:h}};a.prototype.reset=function(){this._trigger("beforeReset");this.$element.find(this.options.groupItemSelector).remove();var b=this.$tabs.find("*[data-loaded]").filter(function(){var c=$(this).data("loaded");return c==true||c=="true"});b.each($.proxy(function(d,e){var c=$(e),f={container:c,loaded:true,tabId:c.data("tabid"),connectsWith:c.data("connectswith")};this._ajaxGetTab({tabModel:f,data:{settings:{Page:1,PageSize:5,TabId:f.tabId,},preventShow:true}})},this));this._uncheckAllItems();this._rebuildNumbers();this._trigger("afterReset")};a.prototype.setTabContent=function(b){var c=this._getSelectedTab();c.html=b;this._initTab(c)};a.prototype.addTabItem=function(b){var c=this._getSelectedTab();c.container.find(this.options.tabItemsListSelector).prepend(b);b.draggable(this._getDraggableOptions(c))};a.prototype.getItemCount=function(c,d){var b=this.$groups.find(this.options.groupItemSelector).filter(function(){return $(this).data("objid")==c&&(typeof d!=="undefined"?$(this).data("tabid")==d:true)}).length;return b};a.prototype.addToGroup=function(h,i,l){var b=this._getGroup(i),k=h.objId,m=h.tabId,j=h.itemModel,c=this._getTab(m),g=c.data("connectswith"),d=this._getTabItem(m,k);if(d.length&&typeof j==="undefined"){j=d.data("model")}var f=!this._isInGroup(k,m,b);if(typeof this.options.validateMove==="function"){var n=this.options.validateMove(j,m,b);f=typeof n==="boolean"?n:f}if(f){var e=this._getGroupItemTemplate(b,m,k,j);var o=this._renderGroupItem(j,b,m,k);e.find(this.options.groupItemContentSelector).html(o);this._checkEditableItem(e);this._initGroupItemForm(e.find(this.options.editorFormSelector));b.find(this.options.groupItemsWrapper).append(e);if(d.length){if(l!==true){d.effect("transfer",{to:b.find(e)})}this._checkItem(d,m,g)}}this._countGroupItems();return f};a.prototype.search=function(e,d){var f;if(typeof e==="number"){var b=this.$element.find("[data-tabid="+e+"]");f={container:b,loaded:container.data("loaded"),tabId:e,connectsWith:b.data("connectswith")}}else{f=e}var c={tabModel:f,data:{settings:{Page:1,PageSize:5,TabId:f.tabId,QuickSearch:f.QuickSearch},preventShow:true,search:d}};this._trigger("beforeTabSearch",0,c);this._ajaxGetTab({tabModel:c.tabModel,data:c.data})};$.widget("bforms.bsGroupEditor",a.prototype);return a});(function(a){if(typeof define==="function"&&define.amd){define("bforms-themeSelect",["jquery","jquery-ui-core","amplify"],a)}else{a(window.jQuery)}}(function(a){var b=requireConfig.websiteOptions;String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var c=function(){};c.prototype.options={targets:"body, .form_container, .grid_toolbar, .grid_view, .bs-datetime-picker, .bs-range-picker, .bs-pager",startTheme:b.startTheme,themeEnum:b.themeEnum,availableColors:"turqoise orange green blue purple black",toggleSelector:".bs-toggleThemeSelect",openSelector:".bs-selectThemeOpen",closeSelector:".bs-selectThemeClose",defaultTheme:"turqoise",optionsSelector:".bs-selectThemeOptions",localStorageSave:false,ajaxSaveUrl:b.saveThemeUrl};c.prototype._init=function(){this.$element=this.element;this._currentColor=this.options.startTheme||"Default";if(this._currentColor=="Default"){this._isDefaultSelected=true}this._currentColorClass=this._currentColor.toLowerCase();this._isOpen=this.$element.find(this.options.closeSelector).is(":visible");if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}this._addDelegates();this._restoreState()};c.prototype._addDelegates=function(){this.$element.on("click",this.options.optionsSelector+" a",a.proxy(this._onColorSelect,this));this.$element.on("click",this.options.toggleSelector,a.proxy(this._onToggleClick,this))};c.prototype._onColorSelect=function(f){f.preventDefault();var d=a(f.currentTarget);if(d.data("isdefault")){this._isDefaultSelected=true}else{this._isDefaultSelected=false}var g=d.data("color");this.setColor(g)};c.prototype._onToggleClick=function(d){d.preventDefault();if(this._isOpen){this.close()}else{this.open()}};c.prototype.setColor=function(d){try{a(this.options.targets).removeClass(this.options.availableColors);a(this.options.targets).removeClass(d);a(this.options.targets).addClass(d);this._currentColor=d;this._currentColorClass=d;if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}else{this.$element.find('*[data-isdefault="true"]').parent().show()}}catch(f){throw"Invalid targets for themeSelect"}this._saveState()};c.prototype.getCurrentColorClass=function(){return this._currentColorClass};c.prototype.open=function(){this.element.find(this.options.openSelector).hide();this.element.find(this.options.closeSelector).show();this.element.removeClass("collapsed");this._isOpen=true};c.prototype.close=function(){this.element.find(this.options.closeSelector).hide();this.element.find(this.options.openSelector).show();this.element.addClass("collapsed");this._isOpen=false};c.prototype._saveState=function(){if(this.options.localStorageSave){var d={Theme:this._currentColor.toUpperCaseFirst(),Open:this._isOpen};amplify.store("themeSelect",d)}if(this.options.ajaxSaveUrl!=null){a.ajax({url:this.options.ajaxSaveUrl,data:{Theme:this._isDefaultSelected?"Default":this.options.themeEnum[this._currentColor.toUpperCaseFirst()],Open:this._isOpen,},type:"POST"})}};c.prototype._restoreState=function(){if(this.options.localStorageSave===true){var e=amplify.store("themeSelect");if(typeof e!=="undefined"&&e!=null){if(e.Theme){var d=e.Theme.toLowerCase();this.setColor(d)}if(e.open){this.open()}}}};a.widget("bforms.bsThemeSelect",c.prototype);return c}));(function(a){if(typeof define==="function"&&define.amd){define("bforms-panel",["jquery","bootstrap","amplify","bforms-ajax","bforms-form"],a)}else{a(window.jQuery)}})(function(a){var b=function(){};b.prototype.options={collapse:true,loaded:false,editable:true,toggleSelector:".bs-togglePanel",editSelector:".bs-editPanel",cancelEditSelector:".bs-cancelEdit",saveFormSelector:".bs-savePanel",containerSelector:".bs-containerPanel",contentSelector:".bs-contentPanel",retrySelector:".bs-retryBtn",headerToggle:false,headerSelector:".bs-panelHeader",cacheReadonlyContent:true,additionalData:{},formOptions:{},retryMessage:"Reload"};b.prototype._init=function(){this.$element=this.element;this.$element.addClass("bs-hasPanel");this.$toggleEleemnt=this.$element.find(this.options.toggleSelector);this._loadOptions();this._initDefaultProperties();this._initSelectors();this._delegateEvents();if(this.options.loaded===true){this._initControls();this._loadState();this._initCurrentContent()}else{var c=this._readonly?"_loadReadonlyContent":"_loadEditableContent";this[c]().then(a.proxy(function(){this._initControls();this._loadState();this._initCurrentContent()},this))}if(!this.$toggleEleemnt.data("expandable")){this._loadState(true)}};b.prototype._loadOptions=function(){var c=this.$element.data("settings");a.extend(true,this.options,c)};b.prototype._initDefaultProperties=function(){this._name=this.options.name||this.$element.prop("id");if(typeof this._name==="undefined"||this._name==""){throw"boxForm requires an unique name"}this._componentId=this.$element.data("component");if(typeof this._componentId==="undefined"){console.warn("No component id specified for "+this._name)}this._objId=this.$element.data("objid");this._key=window.location.pathname+"|BoxForm|"+this._name;if((typeof this.options.initialReadonly==="undefined"||this.options.initialReadonly==true)&&this.$element.data("readonly")!==false){this.showReadonly()}else{this.showEditable()}this.options.readonlyUrl=this.options.readonlyUrl||this.$element.data("readonlyurl");this.options.editableUrl=this.options.editableUrl||this.$element.data("editableurl");this.options.saveUrl=this.options.saveUrl||this.$element.data("saveurl");this._allowExpand=this.options.loaded};b.prototype._initSelectors=function(){this.$container=this.$element.find(this.options.containerSelector);this.$content=this.$element.find(this.options.contentSelector)};b.prototype._delegateEvents=function(){this.$element.on("click",this.options.toggleSelector,a.proxy(this._onToggleClick,this));if(this.options.editable!==false){if(this.options.headerToggle){this.$element.on("click",this.options.headerSelector,a.proxy(this._onHeaderClick,this))}else{this.$element.on("click",this.options.editSelector,a.proxy(this._onEditClick,this))}}this.$element.on("click",this.options.cancelEditSelector,a.proxy(this._onCancelEditClick,this));this.$element.on("click",this.options.retrySelector,a.proxy(this._onRetryClick,this))};b.prototype._initCurrentContent=function(){if(this._readonly){}else{this._initEditable()}};b.prototype._onToggleClick=function(d){d.preventDefault();d.stopPropagation();var c=a(d.currentTarget);if(!c.data("expandable")){return}if(this._allowExpand){if(this._state){this.close()}else{this.open()}}};b.prototype._onHeaderClick=function(c){if(this._readonly==true){this._loadEditableContent().then(a.proxy(function(){if(!this._state&&this._allowExpand){this.open()}},this));c.preventDefault();c.stopPropagation()}};b.prototype._onEditClick=function(c){c.preventDefault();c.stopPropagation();this._loadEditableContent().then(a.proxy(function(){if(!this._state&&this._allowExpand){this.open()}},this))};b.prototype._onCancelEditClick=function(c){c.preventDefault();c.stopPropagation();if(this.options.cacheReadonlyContent&&this._cachedReadonlyContent){this.$content.html(this._cachedReadonlyContent);this.showReadonly();this._toggleEditBtn(true);if(!this._state){this.open()}}else{this._loadReadonlyContent().then(a.proxy(function(){this._toggleEditBtn(true);if(!this._state){this.open()}},this))}};b.prototype._onRetryClick=function(d){var c=a(d.currentTarget),f=c.data("method");if(typeof this[f]==="function"){this[f]()}};b.prototype._saveState=function(){amplify.store(this._key,this._state)};b.prototype._loadState=function(c){if(c){this.open();return}var d=amplify.store(this._key);if(d!=null){if(d==true){this.open()}else{this.close()}}};b.prototype._initControls=function(){if(this.options.editable){this._toggleEditBtn(this._readonly?true:false)}};b.prototype._toggleLoading=function(c){if(c){this.$element.find(".bs-panelLoader").show()}else{this.$element.find(".bs-panelLoader").hide()}};b.prototype._toggleCaret=function(c){if(c){this.$element.find(".bs-panelCaret").show()}else{this.$element.find(".bs-panelCaret").hide()}};b.prototype._toggleEditBtn=function(c){if(c){this.$element.find(this.options.cancelEditSelector).hide().end().find(this.options.editSelector).show()}else{this.$element.find(this.options.editSelector).hide().end().find(this.options.cancelEditSelector).show()}};b.prototype._getXhrData=function(){return a.extend(true,{},{componentId:this._componentId,objId:this._objId},this.options.additionalData)};b.prototype._showErrorMessage=function(e,d,g,f){var c=a('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+e+'<div><a href="#" class="bs-retryBtn" data-method="'+f+'">'+this.options.retryMessage+' <span class="glyphicon glyphicon-refresh"></span> </a></div></div>');if(g){d.html(c)}else{d.append(c)}};b.prototype._initEditable=function(){var c=this.$content.find("form").show(),d=c.find(this.options.saveFormSelector);this._allowExpand=true;if(c.length==0){console.warn("No editable form found")}if(d.length==0){console.warn("No save button found")}var e=a.extend(true,{},{prefix:this.options.prefix,actions:[{name:"save",selector:this.options.saveFormSelector,validate:true,actionUrl:this.options.saveUrl,parse:true,getExtraData:a.proxy(function(f){f.componentId=this._componentId;f.objId=this._objId;a.extend(true,f,this.options.formAdditionalData);this._trigger("beforeSaveAjax",0,f)},this),handler:a.proxy(function(g,f){this._trigger("beforeEditSuccessHandler",0,f);this.$content.html(f.Html);this._toggleLoading();this._toggleEditBtn(true);if(this.options.cacheReadonlyContent){this._cachedReadonlyContent=this.$content.html()}this.showReadonly();this._trigger("editSuccessHandler",0,f)},this)}]},this.options.formOptions);this.$content.find("form").bsForm(e);this._trigger("afterFormInit",0)};b.prototype._loadReadonlyContent=function(){var c=this._getXhrData();this._trigger("beforeReadonlyLoad",c);this.$content.find("form").addClass("loading");return a.bforms.ajax({name:"BsPanel|LoadReadonly|"+this._name,url:this.options.readonlyUrl,data:c,context:this,success:this._onReadonlyLoadSuccess,error:this._onReadonlyLoadError})};b.prototype._onReadonlyLoadSuccess=function(c){this.$content.html(c.Html);this._toggleLoading();this._toggleCaret(true);this._allowExpand=true;if(this.options.cacheReadonlyContent){this._cachedReadonlyContent=this.$content.html()}this._trigger("onReadonlyLoadSuccess",0,c);this.showReadonly()};b.prototype._onReadonlyLoadError=function(d){this.$content.find("form").removeClass("loading");if(d.Message){var c=this.$element.find(".bs-panel-error");if(c.length==0){c=a('<div class="col-sm-12 col-lg-12 bs-validation_row_control bs-panel-error"></div>');this.$container.before(c)}this._toggleLoading();this._showErrorMessage(d.Message,c,true,"_loadReadonlyContent")}};b.prototype._loadEditableContent=function(){var c=this._getXhrData();this._trigger("beforeEditableLoad",c);this.$content.find("form").addClass("loading");return a.bforms.ajax({name:"BsPanel|LoadEditable|"+this._name,url:this.options.editableUrl,context:this,data:c,success:this._onEditableLoadSuccess,error:this._onEditableLoadError})};b.prototype._onEditableLoadSuccess=function(c){if(this.options.cacheReadonlyContent&&this._readonly==true){this._cachedReadonlyContent=this.$content.clone().find("form").removeClass("loading").end().html()}this.$content.html(c.Html);this._initEditable();this._toggleEditBtn();this._toggleLoading();this._toggleCaret(true);this._trigger("onEditableLoadSuccess",0,c);this.showEditable()};b.prototype._onEditableLoadError=function(d){this.$content.find("form").removeClass("loading");if(d.Message){var c=this.$element.find(".bs-panel-error");if(c.length==0){c=a('<div class="col-sm-12 col-lg-12 bs-validation_row_control bs-panel-error"></div>');this.$container.before(c)}this._toggleLoading();this._showErrorMessage(d.Message,c,true,"_loadEditableContent")}};b.prototype.open=function(){var c={allowOpen:true,$content:this.$content};this._trigger("beforeOpen",c);if(c.allowOpen===true){this.$container.stop(true,true).slideDown(300);this.$element.find(this.options.toggleSelector).addClass("dropup")}this._state=true;this._saveState();this._trigger("afterOpen")};b.prototype.close=function(){var c={allowClose:true,$content:this.$content};this._trigger("beforeClose",c);if(c.allowClose===true){this.$container.stop(true,true).slideUp(300);this.$element.find(this.options.toggleSelector).removeClass("dropup")}this._state=false;this._saveState();this._trigger("afterClose")};b.prototype.showReadonly=function(){this._readonly=true;this.$element.data("readonly",true);this.$element.removeClass("bs-panelEditMode");this._trigger("onReadonlyShow",0)};b.prototype.showEditable=function(){this._readonly=false;this.$element.data("readonly",false);this.$element.addClass("bs-panelEditMode");this._trigger("onEditableShow",0)};b.prototype.save=function(){var c=this.$content.find("form");if(typeof c.bsForm==="function"){c.bsForm("triggerAction","save")}};b.prototype.refresh=function(){var c=this._readonly?"_loadReadonlyContent":"_loadEditableContent";this[c]().then(a.proxy(function(){this._initControls();this._loadState()},this))};a.widget("bforms.bsPanel",b.prototype);return b});define("bforms-ajax",["bforms-namespace","jquery"],function(){var a=function(){this._xhrStack={}};a.prototype._defOptions={cache:false,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",context:null,registerGlobal:true,killPrevious:true,loadingDelay:100};a.prototype._getStack=function(){return this._xhrStack};a.prototype._statusEnum={Success:1,ValidationError:2,Denied:3,ServerError:4};a.prototype.getAjaxOptions=function(){return $.extend(true,{},this._defOptions)};a.prototype._updateXHRSettings=function(b){var c=$.extend(true,{},b);c.data=b.contentType===this._defOptions.contentType?JSON.stringify(this._serializeJsonData(b.data)):b.data;return c};a.prototype._serializeJsonData=function(b){var d;if(b instanceof Array){d=b.slice(0)}else{d=$.extend(true,{},b)}for(var c in d){if(d.hasOwnProperty(c)){if(typeof d[c]==="number"){d[c]+=""}else{if(typeof d[c]==="object"){d[c]=this._serializeJsonData(d[c])}}}}return d};a.prototype._killPrevious=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null&&typeof c.jqXHR.abort==="function"&&c.finished!==true){c.aborted=true;c.finished=true;c.jqXHR.abort();this._xhrStack[b]=c;this._toggleLoading(c,true)}};a.prototype._toggleLoading=function(f,e){var c=typeof f==="string"?this._xhrStack[f]:f,d=(typeof c!=="undefined"&&c.settings.loadingClass!=="undefined")?c.settings.loadingClass:this._defaultLoadingClass;if(typeof c!=="undefined"&&typeof c.settings!=="undefined"){var b=c.settings.loadingElement;if(b!=null&&b.length){window.clearTimeout(this.loadingTimeout);if(e){this.loadingTimeout=window.setTimeout(function(){d==null?b.show():b.addClass(d)},c.settings.loadingDelay)}else{d==null?b.hide():b.removeClass(d)}}}};a.prototype.ajax=function(f,b){var h=false;if(typeof File!=="undefined"){for(var e in f.data){if(f.data.hasOwnProperty(e)){if(f.data[e] instanceof File){h=true;break}}}}var i=$.extend({},this.getDefaultOptions(),f),d=null;i.name=i.name||i.url;if(i.killPrevious===true){this._killPrevious(i.name)}var c=$.Deferred();c.done($.proxy(function(k,j){if(k===this._statusEnum.Success){if(typeof f.success==="function"){f.success.apply(f.context,j)}}else{if(k===this._statusEnum.ValidationError){if(typeof f.validationError==="function"){f.validationError.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}}if(k===this._statusEnum.ServerError){if(typeof f.serverError==="function"){f.serverError.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}if(k===this._statusEnum.Denied){if(typeof f.denied==="function"){f.denied.apply(f.context,j)}if(typeof f.error==="function"){f.error.apply(f.context,j)}}},this));c.fail($.proxy(function(k,j){if(k===this._statusEnum.ServerError){if(typeof f.serverError==="function"){f.serverError.apply(f.context,j)}}else{if(k===this._statusEnum.Denied){if(typeof f.denied==="function"){f.denied.apply(f.context,j)}}}if(typeof f.error==="function"){f.error.apply(f.context,j)}},this));if(typeof f.complete==="function"){c.always($.proxy(f.complete,f.context))}if(typeof f.progress==="function"){c.progress($.proxy(f.progress,f.context))}if(h){d=this._ajaxWithFiles(i,b,c)}else{d=this._ajaxWithoutFiles(i,b,c)}var g=c.promise();g.abort=d.abort;g.success=c.done;g.error=c.fail;this._toggleLoading(i.name,true);if(typeof b!=="undefined"&&b!=null){b.deferred=c}return g};a.prototype._ajaxWithoutFiles=function(h,c,d){var f=this;var e=$.extend({},h,{success:function(k,l,j){var m=f._xhrStack[h.name];if(m.aborted===true){return}try{if(k.Status==f._statusEnum.Success||k.Status==f._statusEnum.ValidationError){d.resolve(k.Status,[k.Data,h.callbackData])}else{d.reject(k.Status,[k,j,l,null,h.callbackData])}}catch(i){if(typeof i.stack!=="undefined"){console.warn("Exception occurred in ajax request");console.log(i.stack)}else{console.warn("Exception occurred in ajax request: "+i)}}},error:function(k,m,i){var n=f._xhrStack[h.name];if(typeof n!=="undefined"&&n!=null&&n.aborted===true){return}try{if(typeof k.responseText!=="undefined"){var l=JSON.parse(k.responseText);d.reject(l.Status,[l,k,m,i,h.callbackData])}else{d.reject(f._statusEnum.ServerError,[{Message:i},k,m,i,h.callbackData])}}catch(j){window.console.log(j.stack)}},complete:function(){var i=f._xhrStack[h.name];if(typeof i!=="undefined"){i.finished=true}f._toggleLoading(h.name,false)}});var b=this._updateXHRSettings(e);var g=this._xhrStack[h.name]={jqXHR:$.ajax(b),aborted:false,settings:h};return g.jqXHR};a.prototype._ajaxWithFiles=function(f,b,d){var h=new XMLHttpRequest(),c=new FormData(),g=this;for(var e in f.data){if(f.data.hasOwnProperty(e)){c.append(e,f.data[e])}}f.contentType="";$.extend(true,h,$.extend(true,{},this.getDefaultOptions(),f));h.upload.addEventListener("progress",$.proxy(function(i){i.progress=i.progress/i.total;d.notifyWith(i,f.callbackData)},this));h.onreadystatechange=$.proxy(function(i){var k=this._xhrStack[h.name];if(h.readyState===4&&k.aborted!==true){var j=JSON.parse(h.responseText);if(j.Status==g._statusEnum.Success||j.Status==g._statusEnum.ValidationError){d.resolve(j.Status,[j,f.callbackData])}else{d.reject(j.Status,[j!=null?null:j.Data,jqXHR,textStatus,errorThrown,f.callbackData])}g._toggleLoading(f.name,false)}},this);h.open("POST",f.url,true);h.send(c);this._xhrStack[f.name]={jqXHR:h,aborted:false,settings:f};return this._xhrStack[f.name].jqXHR};a.prototype.getDefaultOptions=function(){return $.extend(true,{},this._defOptions)};a.prototype.abort=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null){c.jqXHR.abort();c.aborted=true}};$.extend(true,$.bforms,new a());return a});/*
 * BForms v1.0.0 Alpha
 * http://bforms.stefanprodan.eu
 *
 * Copyright 2013 Stefan Prodan and contributors
 * http://github.com/stefanprodan/BForms/contributors
 * Licensed under the MIT license
 */
define("bforms-namespace",["jquery","jquery-migrate"],function(a){a.nsx=function(d){var f=d.split("."),e=a,c;if(f[0]==="$"){f=f.slice(1)}else{if(f[0]==="jQuery"){f=f.slice(1)}}for(c=0;c<f.length;c+=1){if(typeof e[f[c]]==="undefined"){e[f[c]]={}}e=e[f[c]]}return e};a.nsx("bforms");var b=function(){};b.prototype.scrollToElement=function(e){var c=$(e);if(c.length>0){var h=a.bforms.getViewport();var g=$(e).offset().top;var f=h.height/2;var d=g;if(f<g){d=g-f}else{d=0}if($.browser.msie&&$.browser.mobile){$("html").scrollTop(d)}else{$("html,body").animate({scrollTop:d},500)}}};b.prototype.getViewport=function(){var i=window,c=document,f=c.documentElement,h=c.getElementsByTagName("body")[0],j=i.innerWidth||f.clientWidth||h.clientWidth,k=i.innerHeight||f.clientHeight||h.clientHeight;return{width:j,height:k}};b.prototype.param=function(c,g){var e,f=[],d=function(h,i){i=a.isFunction(i)?i():(i==null?"":i);f[f.length]=encodeURIComponent(h)+"="+encodeURIComponent(i)};if(g===undefined){g=a.ajaxSettings&&a.ajaxSettings.traditional}if(a.isArray(c)||(c.jquery&&!a.isPlainObject(c))){a.each(c,function(){d(this.name,this.value)})}else{for(e in c){this.buildParams(e,c[e],g,d)}}return f.join("&").replace("/%20/g","+")};b.prototype.buildParams=function(f,e,g,c){var d;if(a.isArray(e)){a.each(e,$.proxy(function(h,j){if(g||/\[\]$/.test(f)){c(f,j)}else{this.buildParams(f+"["+h+"]",j,g,c)}},this))}else{if(!g&&a.type(e)==="object"){for(d in e){this.buildParams(f+"."+d,e[d],g,c)}}else{c(f,e)}}};b.prototype.inherit=function(e,d){for(var f in d){if(d.hasOwnProperty(f)){e[f]=d[f]}}function c(){this.constructor=e}c.prototype=d.prototype;e.prototype=new c()};$.extend(true,$.bforms,new b());return b});